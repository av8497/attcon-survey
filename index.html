<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Media Behaviour Survey</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    min-height: 100vh;
}

.screen {
    padding: 60px 40px;
    min-height: 100vh;
}

.screen h1 {
    font-size: 32px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 30px;
    text-align: center;
}

.screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 10px;
    text-align: center;
}

.screen-subtitle {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 25px 0 15px 0;
}

.screen p {
    font-size: 16px;
    line-height: 1.6;
    color: #4a4a4a;
    margin-bottom: 15px;
}

.screen ul {
    margin-left: 20px;
    margin-bottom: 20px;
}

.screen li {
    margin-bottom: 8px;
    font-size: 16px;
    color: #4a4a4a;
}

.consent-box {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.consent-box input[type="checkbox"] {
    margin-top: 3px;
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.consent-box label {
    font-size: 15px;
    line-height: 1.5;
    color: #4a4a4a;
    cursor: pointer;
}

.btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

.btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.demo-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.demo-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 1.5px solid #e1e5e9;
    border-radius: 8px;
    font-size: 15px;
    color: #1a1a1a;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.anon-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
}

.anon-checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.anon-checkbox label {
    font-size: 13px;
    color: #6a6a6a;
    font-weight: normal;
    margin: 0;
    cursor: pointer;
}

.interface-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.interface-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.interface-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 30px;
}

.interface-card {
    padding: 24px;
    border: 2px solid #e1e5e9;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.interface-card:hover {
    border-color: #667eea;
    transform: translateY(-2px);
}

.interface-card.selected {
    border-color: #667eea;
    background: #f8f9ff;
}

.interface-card .icon {
    font-size: 48px;
    margin-bottom: 12px;
}

.interface-card .name {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.interface-card .desc {
    font-size: 13px;
    color: #6a6a6a;
}

.survey-screen {
    display: none;
    flex-direction: column;
    min-height: 100vh;
}

.survey-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 16px 20px;
    position: sticky;
    top: 0;
    z-index: 100;
}

.survey-header .progress-text {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
}

.progress-bar {
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: white;
    width: 0%;
    transition: width 0.3s ease;
}

.feed {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 0;
}

/* INSTAGRAM SPECIFIC */
.feed.instagram {
    background: #fafafa;
    padding: 0;
}

.instagram .post {
    background: white;
    border: none;
    border-top: 1px solid #dbdbdb;
    border-bottom: 1px solid #dbdbdb;
    margin-bottom: 16px;
}

.instagram .post-header {
    padding: 14px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.instagram .post-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    border: 2px solid transparent;
    background-clip: padding-box;
}

.instagram .brand-info {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
}

.instagram .brand {
    font-size: 14px;
    font-weight: 600;
    color: #262626;
}

.instagram .sponsored {
    font-size: 12px;
    color: #8e8e8e;
    font-weight: 400;
}

.instagram .post-image {
    width: 100%;
    height: 400px;
    background-size: cover;
    background-position: center;
    position: relative;
}

.instagram .shop-banner {
    position: absolute;
    bottom: 12px;
    left: 12px;
    background: rgba(255, 255, 255, 0.95);
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    color: #262626;
    cursor: pointer;
    border: 1px solid rgba(0, 0, 0, 0.1);
    transition: all 0.2s;
}

.instagram .shop-banner:hover {
    background: white;
    transform: scale(1.02);
}

.instagram .post-content {
    padding: 0 16px 8px;
}

.instagram .post-actions {
    display: flex;
    gap: 16px;
    padding: 8px 16px;
    border: none;
    align-items: center;
}

.instagram .action-btn {
    background: none;
    border: none;
    padding: 8px 0;
    cursor: pointer;
    display: flex;
    align-items: center;
}

.instagram .action-icon svg {
    width: 24px;
    height: 24px;
    stroke: #262626;
    fill: none;
    stroke-width: 2;
}

.instagram .post-text {
    font-size: 14px;
    line-height: 18px;
    color: #262626;
    margin-bottom: 8px;
}

.instagram .post-price {
    font-size: 14px;
    font-weight: 600;
    color: #0095f6;
    margin-bottom: 8px;
}

.instagram .buy-btn {
    background: #0095f6;
    color: white;
    border: none;
    padding: 7px 16px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    margin-left: auto;
}

/* FACEBOOK SPECIFIC */
.feed.facebook {
    background: #f0f2f5;
    padding: 16px;
}

.facebook .post {
    background: white;
    border-radius: 8px;
    margin-bottom: 16px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.facebook .post-header {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.facebook .post-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #1877f2;
}

.facebook .brand-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
    margin-left: 8px;
}

.facebook .brand {
    font-size: 15px;
    font-weight: 600;
    color: #050505;
}

.facebook .sponsored {
    font-size: 13px;
    color: #65676b;
}

.facebook .post-image {
    width: 100%;
    height: 400px;
    background-size: cover;
    background-position: center;
    position: relative;
}

.facebook .shop-banner {
    position: absolute;
    bottom: 16px;
    left: 16px;
    right: 16px;
    background: white;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    color: #1877f2;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    border: 1px solid #e4e6eb;
}

.facebook .shop-banner:hover {
    background: #f7f8fa;
}

.facebook .post-content {
    padding: 12px 16px 0;
}

.facebook .post-text {
    font-size: 15px;
    line-height: 1.3333;
    color: #050505;
    margin-bottom: 12px;
}

.facebook .post-price {
    font-size: 17px;
    font-weight: 600;
    color: #1877f2;
    margin-bottom: 12px;
}

.facebook .post-actions {
    display: flex;
    border-top: 1px solid #e4e6eb;
    padding: 4px 8px;
}

.facebook .action-btn {
    flex: 1;
    background: none;
    border: none;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    color: #65676b;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 4px;
}

.facebook .action-btn:hover {
    background: #f2f2f2;
}

.facebook .action-icon svg {
    width: 18px;
    height: 18px;
}

.facebook .buy-btn {
    background: #1877f2;
    color: white;
    border-radius: 6px;
    padding: 6px 12px;
}

/* LINKEDIN SPECIFIC */
.feed.linkedin {
    background: #f3f2ef;
    padding: 16px;
}

.linkedin .post {
    background: white;
    border: 1px solid #e0dfdc;
    border-radius: 8px;
    margin-bottom: 8px;
}

.linkedin .post-header {
    padding: 12px 16px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
}

.linkedin .post-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #0a66c2;
}

.linkedin .brand-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
    margin-left: 8px;
}

.linkedin .brand {
    font-size: 14px;
    font-weight: 600;
    color: #000000e6;
}

.linkedin .brand-subtitle {
    font-size: 12px;
    color: #00000099;
}

.linkedin .sponsored {
    font-size: 12px;
    color: #00000099;
}

.linkedin .post-image {
    width: 100%;
    height: 400px;
    background-size: cover;
    background-position: center;
    position: relative;
}

.linkedin .shop-banner {
    position: absolute;
    bottom: 16px;
    left: 16px;
    right: 16px;
    background: white;
    padding: 10px 16px;
    border-radius: 24px;
    font-size: 14px;
    font-weight: 600;
    color: #0a66c2;
    text-align: center;
    cursor: pointer;
    border: 2px solid #0a66c2;
}

.linkedin .shop-banner:hover {
    background: #eef3f8;
}

.linkedin .post-content {
    padding: 12px 16px 0;
}

.linkedin .post-text {
    font-size: 14px;
    line-height: 1.4;
    color: #000000e6;
    margin-bottom: 12px;
}

.linkedin .post-price {
    font-size: 16px;
    font-weight: 600;
    color: #0a66c2;
    margin-bottom: 12px;
}

.linkedin .post-actions {
    display: flex;
    border-top: 1px solid #e0dfdc;
    padding: 4px 8px;
}

.linkedin .action-btn {
    flex: 1;
    background: none;
    border: none;
    padding: 12px 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    color: #00000099;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 4px;
}

.linkedin .action-btn:hover {
    background: #f3f2ef;
}

.linkedin .action-icon svg {
    width: 20px;
    height: 20px;
}

.linkedin .buy-btn {
    background: #0a66c2;
    color: white;
    border-radius: 16px;
    padding: 6px 16px;
}

/* TIKTOK SPECIFIC */
.feed.tiktok {
    background: #000;
    padding: 0;
    scroll-snap-type: y mandatory;
    overflow-y: scroll;
}

.tiktok .post {
    height: 100vh;
    position: relative;
    background: #000;
    margin-bottom: 0;
    scroll-snap-align: start;
    scroll-snap-stop: always;
}

.tiktok .post-image {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
}

.tiktok .shop-banner {
    position: absolute;
    bottom: 80px;
    left: 16px;
    background: rgba(255, 255, 255, 0.95);
    padding: 10px 20px;
    border-radius: 24px;
    font-size: 14px;
    font-weight: 700;
    color: #000;
    cursor: pointer;
    z-index: 15;
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.tiktok .shop-banner:hover {
    background: white;
    transform: scale(1.05);
}

.tiktok .post-header {
    position: absolute;
    top: 16px;
    left: 16px;
    z-index: 10;
    display: flex;
    align-items: center;
    gap: 8px;
}

.tiktok .post-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid white;
    background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
}

.tiktok .brand {
    font-size: 15px;
    font-weight: 600;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.tiktok .post-content {
    position: absolute;
    bottom: 120px;
    left: 16px;
    right: 80px;
    color: white;
    z-index: 10;
    max-height: 300px;
}

.tiktok .post-text {
    font-size: 14px;
    line-height: 1.4;
    color: white;
    margin-bottom: 8px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.tiktok .post-text.collapsed {
    max-height: 3.6em;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.tiktok .post-text.expanded {
    max-height: none;
    display: block;
}

.tiktok .see-more {
    background: none;
    border: none;
    color: white;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    padding: 0;
    margin-top: 4px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
}

.tiktok .post-price {
    font-size: 16px;
    font-weight: 700;
    color: #fe2c55;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    margin-top: 8px;
}

.tiktok .post-actions {
    position: absolute;
    right: 12px;
    bottom: 140px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    z-index: 20;
}

.tiktok .action-btn {
    background: none;
    border: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    color: white;
    cursor: pointer;
    padding: 0;
}

.tiktok .action-btn:disabled {
    opacity: 0.5;
}

.tiktok .action-icon {
    width: 48px;
    height: 48px;
    background: rgba(84, 84, 84, 0.5);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.tiktok .action-btn:hover:not(:disabled) .action-icon {
    background: rgba(84, 84, 84, 0.7);
    transform: scale(1.1);
}

.tiktok .action-icon svg {
    width: 26px;
    height: 26px;
    fill: white;
}

.tiktok .action-label {
    font-size: 12px;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
}

.tiktok .buy-btn {
    position: absolute;
    bottom: 30px;
    left: 16px;
    background: #fe2c55;
    color: white;
    border: none;
    padding: 12px 32px;
    font-size: 15px;
    font-weight: 700;
    border-radius: 4px;
    cursor: pointer;
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.tiktok .buy-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.results-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
    text-align: center;
}

.results-screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 20px;
}

.results-box {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: left;
}

.results-box h3 {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 16px;
}

.results-box p {
    font-size: 15px;
    color: #4a4a4a;
    margin-bottom: 8px;
}

@media (max-width: 768px) {
    .screen {
        padding: 30px 20px;
    }
    
    .demo-screen,
    .interface-screen {
        padding: 30px 20px;
    }
    
    .interface-grid {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>
<div class="container">
    <div class="screen" id="consentScreen">
        <h1>Social Media Behaviour Survey</h1>
        <p style="text-align:center;color:#4a4a4a;margin-bottom:30px;font-style:italic;line-height:1.8">"Congratulations! You've been invited to participate in research that contributes to the potentially groundbreaking understanding of what will go on to be known as The Attention-Conversion Paradox. I'd like to extend my sincerest gratitude to each and every participant. You're the best!" - Aman Vasandani, 2025</p>
        
        <h2 class="screen-subtitle">About This Research</h2>
        <p>This study examines how people interact with fashion content on different social media platforms. You'll experience realistic social feeds and can interact naturally.</p>
        
        <h2 class="screen-subtitle">What You'll Do</h2>
        <ul>
            <li>Answer a few background questions (2 minutes)</li>
            <li>Choose a social media platform style</li>
            <li>Browse through posts and interact naturally</li>
            <li><strong>Use multiple platforms?</strong> Complete the survey again for each platform you regularly use!</li>
        </ul>
        
        <h2 class="screen-subtitle">Privacy & Data Use</h2>
        <p>Your responses are anonymous and used only for academic research. No personal information is stored or shared.</p>
        
        <div class="consent-box">
            <input type="checkbox" id="consentCheck">
            <label for="consentCheck">I understand this is academic research and consent to participate. I understand my responses are anonymous and used only for research purposes.</label>
        </div>
        
        <button class="btn" id="startBtn" disabled>Start Survey</button>
    </div>

    <div class="demo-screen" id="demoScreen">
        <h2>About You</h2>
        <p>Help us understand shopping patterns across demographics</p>
        
        <div class="form-group">
            <label for="nameInput">Name</label>
            <input type="text" id="nameInput" placeholder="Your first name">
            <div class="anon-checkbox">
                <input type="checkbox" id="anonCheck">
                <label for="anonCheck">I'd like to be anonymous (generates random ID)</label>
            </div>
        </div>

        <div class="form-group">
            <label for="ageInput">Age Range</label>
            <select id="ageInput">
                <option value="">Select age range</option>
                <option value="18-24">18-24</option>
                <option value="25-29">25-29</option>
                <option value="30-34">30-34</option>
                <option value="35-39">35-39</option>
                <option value="40-44">40-44</option>
                <option value="45-50">45-50</option>
                <option value="50+">50+</option>
            </select>
        </div>

        <div class="form-group">
            <label for="countryInput">Country</label>
            <select id="countryInput">
                <option value="">Select country</option>
                <option value="AE">United Arab Emirates</option>
                <option value="SA">Saudi Arabia</option>
                <option value="IN">India</option>
                <option value="PK">Pakistan</option>
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
                <option value="CA">Canada</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="OTHER">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="incomeInput">Monthly Income <span id="currLabel">(USD)</span></label>
            <select id="incomeInput">
                <option value="">Select income range</option>
            </select>
        </div>

        <div class="form-group">
            <label for="genderInput">Gender</label>
            <select id="genderInput">
                <option value="">Select gender</option>
                <option value="Female">Female</option>
                <option value="Male">Male</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Prefer not to say">Prefer not to say</option>
            </select>
        </div>

        <div class="form-group">
            <label for="platformInput">Primary Social Media Platform for Fashion</label>
            <select id="platformInput">
                <option value="">Select platform</option>
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
                <option value="Facebook">Facebook</option>
                <option value="Pinterest">Pinterest</option>
                <option value="YouTube">YouTube</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="freqInput">How often do you shop for fashion items?</label>
            <select id="freqInput">
                <option value="">Select frequency</option>
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="Quarterly">Every few months</option>
                <option value="Rarely">Rarely</option>
            </select>
        </div>

        <button class="btn" id="demoBtn" disabled>Continue to Platform Selection</button>
    </div>

    <div class="interface-screen" id="interfaceScreen">
        <h2>Choose Your Experience</h2>
        <p>Select which social media interface style you'd like to experience:</p>
        
        <div class="interface-grid">
            <div class="interface-card" data-platform="facebook">
                <div class="icon">📘</div>
                <div class="name">Facebook</div>
                <div class="desc">Detailed posts</div>
            </div>
            
            <div class="interface-card" data-platform="instagram">
                <div class="icon">📷</div>
                <div class="name">Instagram</div>
                <div class="desc">Visual-first</div>
            </div>
            
            <div class="interface-card" data-platform="linkedin">
                <div class="icon">💼</div>
                <div class="name">LinkedIn</div>
                <div class="desc">Professional</div>
            </div>
            
            <div class="interface-card" data-platform="tiktok">
                <div class="icon">🎵</div>
                <div class="name">TikTok</div>
                <div class="desc">Full-screen</div>
            </div>
        </div>
        
        <button class="btn" id="interfaceBtn" disabled>Start Experience</button>
    </div>

    <div class="survey-screen" id="surveyScreen">
        <div class="survey-header">
            <div class="progress-text">Scrolled through <span id="qNum">0</span> of <span id="qTotal">15</span> posts</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progFill"></div>
            </div>
        </div>
        <div class="feed" id="feed"></div>
    </div>

    <div class="results-screen" id="resultsScreen">
        <h2>Thank You!</h2>
        <div class="results-box" id="resultsBox"></div>
        <button class="btn" onclick="downloadData()" style="margin-bottom: 16px;">Download Results</button>
        <button class="btn" onclick="restartSurvey()" style="background: linear-gradient(135deg, #51cf66, #37b24d);">Take Survey Again for Another Platform</button>
    </div>
</div>

<script>
var userData = {};
var selectedPlatform = '';
var answers = [];
var postViews = [];
var startTime = Date.now();
var observer = null;

var productImages = [
    'https://i.ibb.co/4nPCjLZq/Plain-T-Shirt.png',
    'https://i.ibb.co/7JwnqcGf/Eco-Sneakers.png',
    'https://i.ibb.co/qYTzhX21/Luxury-Bag.png',
    'https://i.ibb.co/5W16YtT8/White-Shirt.png',
    'https://i.ibb.co/2YkJ8rkt/Hoodie.png',
    'https://i.ibb.co/hJqHZzgY/Leggings.png',
    'https://i.ibb.co/mF49GBqb/Vintage-Jacket.png',
    'https://i.ibb.co/DHhQMpNk/Watch.png',
    'https://i.ibb.co/3mKKvcyd/Summer-Dress.png',
    'https://i.ibb.co/0RjKxKf9/Sweatshirt-Set.png',
    'https://i.ibb.co/274dVCyx/Blazer.png',
    'https://i.ibb.co/Gf4xLxtJ/Street-Sneakers.png',
    'https://i.ibb.co/rRt77DZK/Wide-Leg-Trousers.png',
    'https://i.ibb.co/00YQVty/Sunglasses.png',
    'https://i.ibb.co/HM15qm8/Trench-Coat.png'
];

var questions = [
    {caption: 'The perfect essential tee: soft-washed cotton, ideal drape, and crafted for longevity.', price: 45, brand: 'Core Basics'},
    {caption: 'Step into sustainable style with recycled materials and zero-waste construction.', price: 89, brand: 'Stride Co.'},
    {caption: 'Italian leather, minimalist design, maximum utility. The only bag you need.', price: 156, brand: 'Maison Laurent'},
    {caption: 'Our crisp white shirt redefined with wrinkle-resistant stretch fabric.', price: 67, brand: 'Office Flux'},
    {caption: 'Cozy up in our bestselling French Terry Hoodie. Oversized fit, premium heavyweight fabric.', price: 125, brand: 'Soft Spot'},
    {caption: 'Engineered for movement: high-waisted performance leggings offer compression and breathability.', price: 78, brand: 'AeroFit'},
    {caption: 'The ultimate throwback: a genuine 90s-inspired denim jacket. Limited quantity drop.', price: 95, brand: 'The Archive'},
    {caption: 'Precision engineering meets classic design. The Chrono-X timepiece features sapphire crystal.', price: 189, brand: 'Valenza Orologi'},
    {caption: 'Flowy, light, and vibrant. Our linen-blend summer dress is perfect for vacation.', price: 72, brand: 'Sundays'},
    {caption: 'The ultimate lounge wear set: super-soft organic cotton sweatshirt and joggers.', price: 85, brand: 'Lounge Drop'},
    {caption: 'The unstructured wool-blend blazer. Tailored for comfort, styled for versatility.', price: 145, brand: 'Struktura Atelier'},
    {caption: 'Built for speed, styled for the street. Responsive cushioning and striking silhouette.', price: 110, brand: 'Rush Runner'},
    {caption: 'The ultimate versatile pant: wide-leg trousers in breathable linen blend.', price: 99, brand: 'Vogue Élan'},
    {caption: 'Classic geometry, modern feel. Polarized sunglasses offer 100% UV protection.', price: 65, brand: 'Optic Haze'},
    {caption: 'The iconic trench, redefined. Water-resistant, perfectly structured, and ready for decades.', price: 210, brand: 'Porte-Vent'}
];

// Initialize postViews array
for (var i = 0; i < questions.length; i++) {
    postViews[i] = {
        viewed: false,
        viewStartTime: null,
        totalViewTime: 0,
        interacted: false
    };
}

document.getElementById('consentCheck').addEventListener('change', function() {
    document.getElementById('startBtn').disabled = !this.checked;
});

document.getElementById('startBtn').addEventListener('click', function() {
    document.getElementById('consentScreen').style.display = 'none';
    document.getElementById('demoScreen').style.display = 'block';
});

var demoFields = ['nameInput', 'ageInput', 'countryInput', 'incomeInput', 'genderInput', 'platformInput', 'freqInput'];

demoFields.forEach(function(id) {
    var el = document.getElementById(id);
    el.addEventListener('change', validateDemo);
    el.addEventListener('input', validateDemo);
});

function validateDemo() {
    var filled = demoFields.every(function(id) {
        return document.getElementById(id).value.trim() !== '';
    });
    document.getElementById('demoBtn').disabled = !filled;
}

document.getElementById('anonCheck').addEventListener('change', function() {
    var nameInput = document.getElementById('nameInput');
    if (this.checked) {
        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        var id = 'ANON';
        for (var i = 0; i < 8; i++) {
            id += chars[Math.floor(Math.random() * chars.length)];
        }
        nameInput.value = id;
        nameInput.readOnly = true;
    } else {
        nameInput.value = '';
        nameInput.readOnly = false;
    }
    validateDemo();
});

document.getElementById('countryInput').addEventListener('change', function() {
    var country = this.value;
    var label = document.getElementById('currLabel');
    var select = document.getElementById('incomeInput');
    
    select.innerHTML = '<option value="">Select income range</option>';
    
    var currData = {
        'AE': {curr: 'AED', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'SA': {curr: 'SAR', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'IN': {curr: 'INR', ranges: ['Under 25,000', '25,000-50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', 'Over 150,000']},
        'PK': {curr: 'PKR', ranges: ['Under 50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', '150,000-200,000', 'Over 200,000']},
        'UK': {curr: 'GBP', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'CA': {curr: 'CAD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'AU': {curr: 'AUD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'DE': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'FR': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']}
    };
    
    var info = currData[country] || {curr: 'USD', ranges: ['Under 2,000', '2,000-3,500', '3,500-5,000', '5,000-7,000', '7,000-10,000', 'Over 10,000']};
    label.textContent = '(' + info.curr + ')';
    
    info.ranges.forEach(function(r) {
        var opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        select.appendChild(opt);
    });
});

document.getElementById('demoBtn').addEventListener('click', function() {
    userData = {
        name: document.getElementById('nameInput').value,
        age: document.getElementById('ageInput').value,
        country: document.getElementById('countryInput').value,
        income: document.getElementById('incomeInput').value,
        gender: document.getElementById('genderInput').value,
        platform: document.getElementById('platformInput').value,
        frequency: document.getElementById('freqInput').value,
        anonymous: document.getElementById('anonCheck').checked
    };
    
    document.getElementById('demoScreen').style.display = 'none';
    document.getElementById('interfaceScreen').style.display = 'block';
});

document.querySelectorAll('.interface-card').forEach(function(card) {
    card.addEventListener('click', function() {
        document.querySelectorAll('.interface-card').forEach(function(c) {
            c.classList.remove('selected');
        });
        this.classList.add('selected');
        selectedPlatform = this.dataset.platform;
        document.getElementById('interfaceBtn').disabled = false;
    });
});

document.getElementById('interfaceBtn').addEventListener('click', function() {
    document.getElementById('interfaceScreen').style.display = 'none';
    document.getElementById('surveyScreen').style.display = 'flex';
    initSurvey();
});

function getPriceForCountry(usd, country) {
    var rates = {
        'AE': {r: 3.67, s: 'AED', after: true}, 'SA': {r: 3.75, s: 'SAR', after: true},
        'IN': {r: 83, s: '₹', after: false}, 'PK': {r: 280, s: 'PKR', after: true},
        'US': {r: 1, s: '$', after: false}, 'UK': {r: 0.79, s: '£', after: false},
        'CA': {r: 1.35, s: 'CAD $', after: false}, 'AU': {r: 1.50, s: 'AUD $', after: false},
        'DE': {r: 0.92, s: '€', after: false}, 'FR': {r: 0.92, s: '€', after: false}
    };
    var info = rates[country] || rates['US'];
    var amt = Math.round(usd * info.r);
    return info.after ? (amt + ' ' + info.s) : (info.s + amt);
}

function toggleCaption(captionId, button) {
    var caption = document.getElementById(captionId);
    if (caption.classList.contains('collapsed')) {
        caption.classList.remove('collapsed');
        caption.classList.add('expanded');
        button.textContent = 'less';
    } else {
        caption.classList.add('collapsed');
        caption.classList.remove('expanded');
        button.textContent = '...more';
    }
}

function initSurvey() {
    var feed = document.getElementById('feed');
    feed.innerHTML = '';
    feed.className = 'feed ' + selectedPlatform;
    
    document.getElementById('qTotal').textContent = questions.length;
    
    questions.forEach(function(q, idx) {
        var price = getPriceForCountry(q.price, userData.country);
        var imagePath = productImages[idx];
        
        var post = document.createElement('div');
        post.className = 'post';
        post.dataset.index = idx;
        
        var postHTML = '';
        
        if (selectedPlatform === 'instagram') {
            postHTML = '<div class="post-header"><div class="brand-info"><div class="post-avatar"></div><div style="display:flex;flex-direction:column;"><span class="brand">' + q.brand + '</span><span class="sponsored">Sponsored</span></div></div></div><div class="post-image" style="background-image:url(' + "'" + imagePath + "'" + ')"><div class="shop-banner" onclick="answer(' + idx + ',' + "'buy'" + ')">Shop Now</div></div><div class="post-actions"><button class="action-btn" onclick="answer(' + idx + ',' + "'like'" + ')"><div class="action-icon"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></div></button><button class="action-btn" onclick="answer(' + idx + ',' + "'comment'" + ')"><div class="action-icon"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg></div></button><button class="action-btn" onclick="answer(' + idx + ',' + "'share'" + ')"><div class="action-icon"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></div></button></div><div class="post-content"><div class="post-text"><strong>' + q.brand + '</strong> ' + q.caption + '</div><div class="post-price">' + price + '</div></div>';
        } else if (selectedPlatform === 'facebook') {
            postHTML = '<div class="post-header"><div class="post-avatar"></div><div class="brand-info"><span class="brand">' + q.brand + '</span><span class="sponsored">Sponsored · Follow</span></div></div><div class="post-content"><div class="post-text">' + q.caption + '</div><div class="post-price">' + price + '</div></div><div class="post-image" style="background-image:url(' + "'" + imagePath + "'" + ')"><div class="shop-banner" onclick="answer(' + idx + ',' + "'buy'" + ')">Shop Now</div></div><div class="post-actions"><button class="action-btn" onclick="answer(' + idx + ',' + "'like'" + ')"><div class="action-icon"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M1 8.5C1 4.91 3.91 2 7.5 2c2.04 0 3.85.94 5 2.4C13.65 2.94 15.46 2 17.5 2 21.09 2 24 4.91 24 8.5c0 6.5-10.5 13-12 13S0 15 0 8.5z"/></svg></div><span>Like</span></button><button class="action-btn" onclick="answer(' + idx + ',' + "'comment'" + ')"><div class="action-icon"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M2 9.5C2 5.91 4.91 3 8.5 3h3C15.09 3 18 5.91 18 9.5S15.09 16 11.5 16H10v3l-4-3H4.5C2.91 16 1 14.09 1 12.5v-3z"/></svg></div><span>Comment</span></button><button class="action-btn" onclick="answer(' + idx + ',' + "'share'" + ')"><div class="action-icon"><svg fill="currentColor" viewBox="0 0 20 20"><path d="M15 8c.83 0 1.5.67 1.5 1.5S15.83 11 15 11s-1.5-.67-1.5-1.5S14.17 8 15 8zm0-4c.83 0 1.5.67 1.5 1.5S15.83 7 15 7s-1.5-.67-1.5-1.5S14.17 4 15 4zM5 11c-.83 0-1.5-.67-1.5-1.5S4.17 8 5 8s1.5.67 1.5 1.5S5.83 11 5 11z"/></svg></div><span>Share</span></button></div>';
        } else if (selectedPlatform === 'linkedin') {
            postHTML = '<div class="post-header"><div class="post-avatar"></div><div class="brand-info"><span class="brand">' + q.brand + '</span><span class="brand-subtitle">Fashion & Apparel</span><span class="sponsored">Promoted</span></div></div><div class="post-content"><div class="post-text">' + q.caption + '</div><div class="post-price">' + price + '</div></div><div class="post-image" style="background-image:url(' + "'" + imagePath + "'" + ')"><div class="shop-banner" onclick="answer(' + idx + ',' + "'buy'" + ')">Learn More</div></div><div class="post-actions"><button class="action-btn" onclick="answer(' + idx + ',' + "'like'" + ')"><div class="action-icon"><svg fill="currentColor" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 9.5h-7v-1h7v1z"/></svg></div><span>Like</span></button><button class="action-btn" onclick="answer(' + idx + ',' + "'comment'" + ')"><div class="action-icon"><svg fill="currentColor" viewBox="0 0 16 16"><path d="M2 3.5A1.5 1.5 0 0 1 3.5 2h9A1.5 1.5 0 0 1 14 3.5v7a1.5 1.5 0 0 1-1.5 1.5H6.414l-2.854 2.854A.5.5 0 0 1 3 14.5V12H3.5A1.5 1.5 0 0 1 2 10.5v-7z"/></svg></div><span>Comment</span></button><button class="action-btn" onclick="answer(' + idx + ',' + "'share'" + ')"><div class="action-icon"><svg fill="currentColor" viewBox="0 0 16 16"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg></div><span>Repost</span></button></div>';
        } else if (selectedPlatform === 'tiktok') {
            var captionId = 'caption-' + idx;
            postHTML = '<div class="post-image" style="background-image:url(' + "'" + imagePath + "'" + ')"><div class="shop-banner" onclick="answer(' + idx + ',' + "'buy'" + ')">Shop Now</div></div><div class="post-header"><div class="post-avatar"></div><span class="brand">@' + q.brand.toLowerCase().replace(/ /g, '') + '</span></div><div class="post-content"><div class="post-text collapsed" id="' + captionId + '">' + q.caption + '</div><button class="see-more" onclick="toggleCaption(' + "'" + captionId + "'" + ',this)">...more</button><div class="post-price">' + price + '</div></div><div class="post-actions"><button class="action-btn" onclick="answer(' + idx + ',' + "'like'" + ')"><div class="action-icon"><svg viewBox="0 0 48 48" fill="white"><path d="M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"/></svg></div><span class="action-label">Like</span></button><button class="action-btn" onclick="answer(' + idx + ',' + "'comment'" + ')"><div class="action-icon"><svg viewBox="0 0 48 48" fill="white"><path d="M47.5 46.1l-2.8-11c1.8-3.3 2.8-7.1 2.8-11.1C47.5 11 37 .5 24 .5S.5 11 .5 24 11 47.5 24 47.5c4 0 7.8-1 11.1-2.8l11 2.8c.8.2 1.6-.6 1.4-1.4zm-3-22.1c0 4-1 7-2.6 10-.2.4-.3.9-.2 1.4l2.1 8.4-8.3-2.1c-.5-.1-1 0-1.4.2-3 1.5-6 2.6-10 2.6-11.4 0-20.6-9.2-20.6-20.5S12.7 3.5 24 3.5 44.5 12.7 44.5 24z"/></svg></div><span class="action-label">Comment</span></button><button class="action-btn" onclick="answer(' + idx + ',' + "'share'" + ')"><div class="action-icon"><svg viewBox="0 0 48 48" fill="white"><path d="M46.5 13.5l-6-6c-.6-.6-1.5-.6-2.1 0l-6 6c-.6.6-.6 1.5 0 2.1s1.5.6 2.1 0l3.4-3.4v21.2c0 .8.7 1.5 1.5 1.5s1.5-.7 1.5-1.5V12.3l3.4 3.4c.3.3.7.4 1.1.4s.8-.1 1.1-.4c.6-.6.6-1.5 0-2.2zm-23.3 0l-6-6c-.6-.6-1.5-.6-2.1 0l-6 6c-.6.6-.6 1.5 0 2.1s1.5.6 2.1 0l3.4-3.4v21.2c0 .8.7 1.5 1.5 1.5s1.5-.7 1.5-1.5V12.3l3.4 3.4c.3.3.7.4 1.1.4s.8-.1 1.1-.4c.6-.6.6-1.5 0-2.2z"/></svg></div><span class="action-label">Share</span></button></div>';
        }
        
        post.innerHTML = postHTML;
        feed.appendChild(post);
    });
    
    // Set up Intersection Observer to track post views
    setupViewTracking();
}

function setupViewTracking() {
    var options = {
        root: null,
        rootMargin: '0px',
        threshold: 0.5 // Post is considered viewed when 50% visible
    };
    
    observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            var idx = parseInt(entry.target.dataset.index);
            var now = Date.now();
            
            if (entry.isIntersecting) {
                // Post came into view
                if (!postViews[idx].viewed) {
                    postViews[idx].viewed = true;
                }
                postViews[idx].viewStartTime = now;
            } else {
                // Post left view
                if (postViews[idx].viewStartTime) {
                    var viewDuration = now - postViews[idx].viewStartTime;
                    postViews[idx].totalViewTime += viewDuration;
                    postViews[idx].viewStartTime = null;
                }
            }
            
            updateProgress();
        });
    }, options);
    
    // Observe all posts
    document.querySelectorAll('.post').forEach(function(post) {
        observer.observe(post);
    });
}

function answer(idx, choice) {
    var now = Date.now();
    var post = document.querySelector('[data-index="' + idx + '"]');

    if (!answers.some(function(a) { return a.question_index === idx; })) {
        // Mark as interacted
        postViews[idx].interacted = true;
        
        // Calculate final view time if currently viewing
        if (postViews[idx].viewStartTime) {
            var viewDuration = now - postViews[idx].viewStartTime;
            postViews[idx].totalViewTime += viewDuration;
            postViews[idx].viewStartTime = now; // Reset for continued viewing
        }
        
        answers.push({
            question_index: idx,
            platform: selectedPlatform,
            action: choice,
            time_ms: now - startTime,
            view_time_ms: postViews[idx].totalViewTime
        });
        
        var btns = post.querySelectorAll('.action-btn, .buy-btn');
        btns.forEach(function(b) { b.disabled = true; });

        updateProgress();

        // Check if all posts have been viewed (interacted or not)
        var allViewed = postViews.every(function(pv) { return pv.viewed; });
        
        if (allViewed) {
            setTimeout(showResults, 1000);
        } else {
            setTimeout(function() {
                var next = document.querySelector('[data-index="' + (idx + 1) + '"]');
                if (next) {
                    next.scrollIntoView({behavior: 'smooth', block: 'start'});
                }
            }, 500);
        }
    }
}

function updateProgress() {
    var viewedCount = postViews.filter(function(pv) { return pv.viewed; }).length;
    var total = questions.length;
    var pct = (viewedCount / total) * 100;
    document.getElementById('qNum').textContent = viewedCount;
    document.getElementById('progFill').style.width = pct + '%';
}

function showResults() {
    // Clean up observer
    if (observer) {
        observer.disconnect();
    }
    
    // Calculate final view times for any posts still being viewed
    var now = Date.now();
    postViews.forEach(function(pv) {
        if (pv.viewStartTime) {
            var viewDuration = now - pv.viewStartTime;
            pv.totalViewTime += viewDuration;
            pv.viewStartTime = null;
        }
    });
    
    document.getElementById('surveyScreen').style.display = 'none';
    document.getElementById('resultsScreen').style.display = 'block';
    
    var totalTime = Math.floor((Date.now() - startTime) / 1000);
    var interactedCount = answers.length;
    var viewedButNotInteracted = postViews.filter(function(pv) { 
        return pv.viewed && !pv.interacted; 
    }).length;
    var totalViewed = postViews.filter(function(pv) { return pv.viewed; }).length;
    
    var totalResponseTime = answers.reduce(function(sum, a) { return sum + a.time_ms; }, 0);
    var avgTime = interactedCount > 0 ? totalResponseTime / interactedCount / 1000 : 0;
    
    // Calculate average view time for all viewed posts
    var totalViewTime = postViews.reduce(function(sum, pv) { 
        return pv.viewed ? sum + pv.totalViewTime : sum; 
    }, 0);
    var avgViewTime = totalViewed > 0 ? totalViewTime / totalViewed / 1000 : 0;
    
    document.getElementById('resultsBox').innerHTML = '<h3>Survey Complete!</h3><p><strong>Platform:</strong> ' + selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1) + '</p><p><strong>Posts Viewed:</strong> ' + totalViewed + ' of ' + questions.length + '</p><p><strong>Posts Interacted With:</strong> ' + interactedCount + '</p><p><strong>Posts Scrolled Past:</strong> ' + viewedButNotInteracted + '</p><p><strong>Total Time:</strong> ' + Math.floor(totalTime / 60) + ':' + String(totalTime % 60).padStart(2, '0') + '</p><p><strong>Average View Time:</strong> ' + avgViewTime.toFixed(1) + 's per post</p><p><strong>Average Interaction Time:</strong> ' + (interactedCount > 0 ? avgTime.toFixed(1) : 'N/A') + 's</p><p style="margin-top:16px;font-style:italic;">Thank you for contributing to fashion retail research!</p>';
}

function downloadData() {
    var data = {
        demographics: userData,
        platform: selectedPlatform,
        answers: answers,
        postViews: postViews,
        totalTime_ms: Date.now() - startTime,
        timestamp: new Date().toISOString()
    };
    
    fetch('YOUR_GOOGLE_SCRIPT_URL_HERE', {
        method: 'POST',
        mode: 'no-cors',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    }).catch(function(err) {
        console.log('Upload expected to fail without Google Script URL');
    });
    
    var blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'survey-' + userData.name.substring(0,4) + '-' + selectedPlatform + '-' + Date.now() + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function restartSurvey() {
    // Reset all variables
    userData = {};
    selectedPlatform = '';
    answers = [];
    startTime = Date.now();
    
    // Reset postViews
    for (var i = 0; i < questions.length; i++) {
        postViews[i] = {
            viewed: false,
            viewStartTime: null,
            totalViewTime: 0,
            interacted: false
        };
    }
    
    // Disconnect observer
    if (observer) {
        observer.disconnect();
        observer = null;
    }
    
    // Reset all form inputs
    document.getElementById('consentCheck').checked = false;
    document.getElementById('startBtn').disabled = true;
    document.getElementById('nameInput').value = '';
    document.getElementById('nameInput').readOnly = false;
    document.getElementById('anonCheck').checked = false;
    document.getElementById('ageInput').value = '';
    document.getElementById('countryInput').value = '';
    document.getElementById('incomeInput').innerHTML = '<option value="">Select income range</option>';
    document.getElementById('currLabel').textContent = '(USD)';
    document.getElementById('genderInput').value = '';
    document.getElementById('platformInput').value = '';
    document.getElementById('freqInput').value = '';
    document.getElementById('demoBtn').disabled = true;
    
    // Remove selected state from interface cards
    document.querySelectorAll('.interface-card').forEach(function(c) {
        c.classList.remove('selected');
    });
    document.getElementById('interfaceBtn').disabled = true;
    
    // Hide all screens except consent screen
    document.getElementById('consentScreen').style.display = 'block';
    document.getElementById('demoScreen').style.display = 'none';
    document.getElementById('interfaceScreen').style.display = 'none';
    document.getElementById('surveyScreen').style.display = 'none';
    document.getElementById('resultsScreen').style.display = 'none';
    
    // Scroll to top
    window.scrollTo(0, 0);
}
</script>
</body>
</html>
