<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Media Behaviour Survey</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    min-height: 100vh;
}

.screen {
    padding: 60px 40px;
    min-height: 100vh;
}

.screen h1 {
    font-size: 32px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 30px;
    text-align: center;
}

.screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 10px;
    text-align: center;
}

.screen-subtitle {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 25px 0 15px 0;
}

.screen p {
    font-size: 16px;
    line-height: 1.6;
    color: #4a4a4a;
    margin-bottom: 15px;
}

.screen ul {
    margin-left: 20px;
    margin-bottom: 20px;
}

.screen li {
    margin-bottom: 8px;
    font-size: 16px;
    color: #4a4a4a;
}

.consent-box {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.consent-box input[type="checkbox"] {
    margin-top: 3px;
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.consent-box label {
    font-size: 15px;
    line-height: 1.5;
    color: #4a4a4a;
    cursor: pointer;
}

.btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

.btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.demo-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.demo-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 1.5px solid #e1e5e9;
    border-radius: 8px;
    font-size: 15px;
    color: #1a1a1a;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.anon-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
}

.anon-checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.anon-checkbox label {
    font-size: 13px;
    color: #6a6a6a;
    font-weight: normal;
    margin: 0;
    cursor: pointer;
}

.interface-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.interface-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.interface-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 30px;
}

.interface-card {
    padding: 24px;
    border: 2px solid #e1e5e9;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.interface-card:hover {
    border-color: #667eea;
    transform: translateY(-2px);
}

.interface-card.selected {
    border-color: #667eea;
    background: #f8f9ff;
}

.interface-card .icon {
    font-size: 48px;
    margin-bottom: 12px;
}

.interface-card .name {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.interface-card .desc {
    font-size: 13px;
    color: #6a6a6a;
}

.survey-screen {
    display: none;
    flex-direction: column;
    min-height: 100vh;
}

.survey-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 16px 20px;
    position: sticky;
    top: 0;
    z-index: 100;
}

.survey-header .progress-text {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
}

.progress-bar {
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: white;
    width: 0%;
    transition: width 0.3s ease;
}

.feed {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 16px;
    background: #f8f9fa;
}

/* Platform-specific styling */
.feed.instagram {
    background: #fafafa;
}

.feed.facebook {
    background: #f0f2f5;
}

.feed.linkedin {
    background: #f3f2ef;
}

.feed.tiktok {
    background: #000;
}

/* Post cards */
.post {
    background: white;
    border-radius: 0;
    margin-bottom: 12px;
    overflow: hidden;
}

.instagram .post {
    border-radius: 0;
    border: 1px solid #dbdbdb;
    margin-bottom: 24px;
}

.facebook .post {
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    margin-bottom: 16px;
}

.linkedin .post {
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    margin-bottom: 8px;
}

.tiktok .post {
    border-radius: 0;
    margin-bottom: 0;
    border: none;
}

.post-header {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.post-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 16px;
}

.instagram .post-avatar {
    border: 2px solid #c13584;
}

.post-info .brand {
    font-size: 14px;
    font-weight: 600;
    color: #262626;
}

.post-info .time {
    font-size: 12px;
    color: #8e8e8e;
}

.post-image {
    width: 100%;
    height: 300px;
    background-size: cover;
    background-position: center;
    position: relative;
}

.tiktok .post-image {
    height: 500px;
}

.post-content {
    padding: 12px 16px;
}

.post-text {
    font-size: 14px;
    line-height: 1.5;
    color: #262626;
    margin-bottom: 12px;
}

.post-price {
    font-size: 20px;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 12px;
}

/* Action buttons - platform specific */
.post-actions {
    display: flex;
    gap: 16px;
    padding: 8px 16px;
    border-top: 1px solid #efefef;
}

.instagram .post-actions {
    border-top: none;
    padding: 6px 16px 12px;
    gap: 16px;
}

.facebook .post-actions {
    border-top: 1px solid #e4e6eb;
    padding: 4px 16px;
    justify-content: space-around;
}

.linkedin .post-actions {
    border-top: 1px solid #e0e0e0;
    padding: 4px 8px;
    justify-content: space-around;
}

.tiktok .post-actions {
    position: absolute;
    right: 12px;
    bottom: 100px;
    flex-direction: column;
    gap: 20px;
    border: none;
    padding: 0;
}

.action-btn {
    background: none;
    border: none;
    padding: 8px 12px;
    font-size: 13px;
    font-weight: 500;
    color: #65676b;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.instagram .action-btn {
    padding: 4px;
    color: #262626;
}

.facebook .action-btn {
    flex: 1;
    justify-content: center;
    color: #65676b;
}

.linkedin .action-btn {
    flex: 1;
    justify-content: center;
    color: #00000099;
}

.tiktok .action-btn {
    flex-direction: column;
    color: white;
    gap: 4px;
    font-size: 11px;
    padding: 0;
}

.action-btn:hover:not(:disabled) {
    color: #667eea;
}

.instagram .action-btn:hover:not(:disabled) {
    opacity: 0.6;
}

.facebook .action-btn:hover:not(:disabled) {
    background: #f2f2f2;
    border-radius: 4px;
}

.linkedin .action-btn:hover:not(:disabled) {
    background: #f3f2ef;
    border-radius: 4px;
}

.tiktok .action-btn:hover:not(:disabled) {
    transform: scale(1.1);
}

.action-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.action-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.instagram .action-icon {
    width: 24px;
    height: 24px;
}

.tiktok .action-icon {
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 50%;
}

/* Buy Now button special styling */
.buy-btn {
    background: #667eea;
    color: white;
    border-radius: 6px;
    padding: 8px 16px;
    font-weight: 600;
}

.instagram .buy-btn {
    background: #0095f6;
}

.facebook .buy-btn {
    background: #1877f2;
}

.linkedin .buy-btn {
    background: #0a66c2;
}

.tiktok .buy-btn {
    background: #fe2c55;
    border-radius: 4px;
    padding: 8px 12px;
}

.buy-btn:hover:not(:disabled) {
    opacity: 0.9;
}

.results-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
    text-align: center;
}

.results-screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 20px;
}

.results-box {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: left;
}

.results-box h3 {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 16px;
}

.results-box p {
    font-size: 15px;
    color: #4a4a4a;
    margin-bottom: 8px;
}

@media (max-width: 768px) {
    .screen {
        padding: 30px 20px;
    }
    
    .demo-screen,
    .interface-screen {
        padding: 30px 20px;
    }
    
    .interface-grid {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>
<div class="container">
    <div class="screen" id="consentScreen">
        <h1>Social Media Behaviour Survey</h1>
        <p style="text-align:center;color:#4a4a4a;margin-bottom:30px;font-style:italic;line-height:1.8">"Congratulations! You've been invited to participate in research that contributes to the potentially groundbreaking understanding of what will go on to be known as The Attention-Conversion Paradox. I'd like to extend my sincerest gratitude to each and every participant. You're the best!" - Aman Vasandani, 2025</p>
        
        <h2 class="screen-subtitle">About This Research</h2>
        <p>This study examines how people interact with fashion content on different social media platforms. You'll experience realistic social feeds and can interact naturally.</p>
        
        <h2 class="screen-subtitle">What You'll Do</h2>
        <ul>
            <li>Answer a few background questions (2 minutes)</li>
            <li>Choose a social media platform style</li>
            <li>Browse through posts and interact naturally</li>
        </ul>
        
        <h2 class="screen-subtitle">Privacy & Data Use</h2>
        <p>Your responses are anonymous and used only for academic research. No personal information is stored or shared.</p>
        
        <div class="consent-box">
            <input type="checkbox" id="consentCheck">
            <label for="consentCheck">I understand this is academic research and consent to participate. I understand my responses are anonymous and used only for research purposes.</label>
        </div>
        
        <button class="btn" id="startBtn" disabled>Start Survey</button>
    </div>

    <div class="demo-screen" id="demoScreen">
        <h2>About You</h2>
        <p>Help us understand shopping patterns across demographics</p>
        
        <div class="form-group">
            <label for="nameInput">Name</label>
            <input type="text" id="nameInput" placeholder="Your first name">
            <div class="anon-checkbox">
                <input type="checkbox" id="anonCheck">
                <label for="anonCheck">I'd like to be anonymous (generates random ID)</label>
            </div>
        </div>

        <div class="form-group">
            <label for="ageInput">Age Range</label>
            <select id="ageInput">
                <option value="">Select age range</option>
                <option value="18-24">18-24</option>
                <option value="25-29">25-29</option>
                <option value="30-34">30-34</option>
                <option value="35-39">35-39</option>
                <option value="40-44">40-44</option>
                <option value="45-50">45-50</option>
                <option value="50+">50+</option>
            </select>
        </div>

        <div class="form-group">
            <label for="countryInput">Country</label>
            <select id="countryInput">
                <option value="">Select country</option>
                <option value="AE">United Arab Emirates</option>
                <option value="SA">Saudi Arabia</option>
                <option value="IN">India</option>
                <option value="PK">Pakistan</option>
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
                <option value="CA">Canada</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="OTHER">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="incomeInput">Monthly Income <span id="currLabel">(USD)</span></label>
            <select id="incomeInput">
                <option value="">Select income range</option>
            </select>
        </div>

        <div class="form-group">
            <label for="genderInput">Gender</label>
            <select id="genderInput">
                <option value="">Select gender</option>
                <option value="Female">Female</option>
                <option value="Male">Male</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Prefer not to say">Prefer not to say</option>
            </select>
        </div>

        <div class="form-group">
            <label for="platformInput">Primary Social Media Platform for Fashion</label>
            <select id="platformInput">
                <option value="">Select platform</option>
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
                <option value="Facebook">Facebook</option>
                <option value="Pinterest">Pinterest</option>
                <option value="YouTube">YouTube</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="freqInput">How often do you shop for fashion items?</label>
            <select id="freqInput">
                <option value="">Select frequency</option>
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="Quarterly">Every few months</option>
                <option value="Rarely">Rarely</option>
            </select>
        </div>

        <button class="btn" id="demoBtn" disabled>Continue to Platform Selection</button>
    </div>

    <div class="interface-screen" id="interfaceScreen">
        <h2>Choose Your Experience</h2>
        <p>Select which social media interface style you'd like to experience:</p>
        
        <div class="interface-grid">
            <div class="interface-card" data-platform="facebook">
                <div class="icon">📘</div>
                <div class="name">Facebook</div>
                <div class="desc">Detailed posts</div>
            </div>
            
            <div class="interface-card" data-platform="instagram">
                <div class="icon">📷</div>
                <div class="name">Instagram</div>
                <div class="desc">Visual-first</div>
            </div>
            
            <div class="interface-card" data-platform="linkedin">
                <div class="icon">💼</div>
                <div class="name">LinkedIn</div>
                <div class="desc">Professional</div>
            </div>
            
            <div class="interface-card" data-platform="tiktok">
                <div class="icon">🎵</div>
                <div class="name">TikTok</div>
                <div class="desc">Full-screen</div>
            </div>
        </div>
        
        <button class="btn" id="interfaceBtn" disabled>Start Experience</button>
    </div>

    <div class="survey-screen" id="surveyScreen">
        <div class="survey-header">
            <div class="progress-text">Question <span id="qNum">1</span> of <span id="qTotal">12</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progFill"></div>
            </div>
        </div>
        <div class="feed" id="feed"></div>
    </div>

    <div class="results-screen" id="resultsScreen">
        <h2>Thank You!</h2>
        <p style="font-size: 18px; margin-bottom: 24px;">Thank you for your participation!</p>
        <div class="results-box" id="resultsBox"></div>
        <button class="btn" onclick="downloadData()">Download Results</button>
    </div>
</div>

<script>
// Global variables
var userData = {};
var selectedPlatform = '';
var answers = [];
var startTime = Date.now();

// Product images with CSS gradients
var productImages = [
    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
    'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
    'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
    'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
    'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
    'linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%)',
    'linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)',
    'linear-gradient(135deg, #f8b195 0%, #f67280 100%)'
];

// 12 Survey questions
var questions = [
    {text: 'When you discover new brands on social media, which platforms make you feel most confident about their quality?', image: 'Cotton T-Shirt', price: 45},
    {text: 'Think about your last purchase discovered through social media. How many times did you see it before buying?', image: 'Eco Sneakers', price: 89},
    {text: 'What is the biggest gap between what catches your attention online and what you actually purchase?', image: 'Designer Handbag', price: 156},
    {text: 'How do you balance quality vs quantity when shopping online?', image: 'White Shirt', price: 67},
    {text: 'Do likes or comments on a fashion post influence your perception of whether it is worth buying?', image: 'Hoodie', price: 125},
    {text: 'When you see influencers or friends wearing something, does that make you more likely to buy it compared to ads?', image: 'Leggings', price: 78},
    {text: 'Do you research products on multiple platforms before buying, or do you make impulse purchases?', image: 'Vintage Jacket', price: 95},
    {text: 'When buying accessories, do you prioritize brands you have seen multiple times on social media?', image: 'Watch', price: 189},
    {text: 'Are you more likely to buy trending seasonal items or classic pieces that appear less frequently?', image: 'Summer Dress', price: 72},
    {text: 'Do promotional posts with discount codes make you more likely to buy immediately?', image: 'Sweatshirt Set', price: 85},
    {text: 'When you see the same product across multiple platforms, does that increase your trust in it?', image: 'Blazer', price: 145},
    {text: 'Final question: Which type of content makes you most likely to actually purchase?', image: 'Sneakers', price: 110}
];

// SVG icons for different platforms
var icons = {
    like: {
        instagram: '<svg aria-label="Like" color="rgb(38, 38, 38)" fill="rgb(38, 38, 38)" height="24" viewBox="0 0 48 48" width="24"><path d="M34.6 6.1c5.7 0 10.4 4.7 10.4 10.4 0 10.8-10.9 19.3-21.3 28.5C13.2 35.8 2.2 27.2 2.2 16.5c0-5.7 4.7-10.4 10.4-10.4 4.1 0 6.9 2 8.7 3.8l.1.1.1-.1c1.8-1.8 4.6-3.8 8.7-3.8zm0-3c-5.8 0-9.8 4-11.4 5.6C21.4 7.1 17.5 3.1 11.6 3.1 5.3 3.1.2 8.2.2 14.5c0 10.6 10.1 19 20.2 28l1.4 1.2c.2.1.4.2.6.2.2 0 .4-.1.6-.2l1.4-1.2C37.7 33.5 47.8 25.1 47.8 14.5c0-6.3-5.1-11.4-11.2-11.4z"></path></svg>',
        facebook: '<svg fill="#1877F2" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14h-2v-6h2v6zm0-8h-2V6h2v2z"/></svg>', 
        linkedin: '<svg fill="#00000099" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm1 14h-2v-6h2v6zm0-8h-2V6h2v2z"/></svg>', 
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M34.6 6.1c-1.6 0-2.9 1.3-2.9 2.9v20.3c0 6.4-5.2 11.6-11.6 11.6s-11.6-5.2-11.6-11.6 5.2-11.6 11.6-11.6c.3 0 .7 0 1 .1v-5.2c-.3 0-.7-.1-1-.1-9.2 0-16.7 7.5-16.7 16.7S10.9 46 20.1 46s16.7-7.5 16.7-16.7V15.8c2.6 1.9 5.8 3 9.2 3V13.6c-5.8 0-10.5-4.7-10.5-10.5h-5.1z"/></svg>'
    },
    comment: {
        instagram: '<svg aria-label="Comment" color="rgb(38, 38, 38)" fill="rgb(38, 38, 38)" height="24" viewBox="0 0 48 48" width="24"><path d="M47.5 46.1l-2.8-11c1.8-3.3 2.8-7.3 2.8-11.4C47.5 11 37.5 1 24 1S.5 11 .5 24c0 12.8 9.2 23.6 21.6 25.4l.6.6.6-.6c.7-.6 1.7-1 2.8-1.1h.4c.5 0 .9.1 1.3.3l11.4 2.8zM24 45.1C13.2 45.1 4.5 36.4 4.5 25.6c0-10.8 8.7-19.5 19.5-19.5s19.5 8.7 19.5 19.5c0 4-.9 7.8-2.6 11.3l.1.1-2.4 9.6-11.8-2.9h-.6c-.5 0-.9 0-1.3-.1z"></path></svg>',
        facebook: '<svg fill="#65676B" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14h-2v-2h2v2zm0-4h-2V6h2v6z"/></svg>', 
        linkedin: '<svg fill="#00000099" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm1 14h-2v-2h2v2zm0-4h-2V6h2v6z"/></svg>', 
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm-2-6h4v4h-4zm0-16h4v12h-4z"/></svg>'
    },
    share: {
        instagram: '<svg aria-label="Share Post" color="rgb(38, 38, 38)" fill="rgb(38, 38, 38)" height="24" viewBox="0 0 48 48" width="24"><path d="M46.8 3.1c-.2-.2-.5-.3-.7-.3h-44c-.3 0-.6.1-.8.3-.3.2-.4.5-.3.8l.2 16c0 .3.2.6.5.8l14.9 8.2-14.8 8.1c-.3.2-.4.5-.3.8.1.3.3.6.7.7h29c.2 0 .4-.1.6-.2l14.9-8.1c.3-.2.5-.5.5-.8v-16c0-.3-.1-.6-.4-.8zM43.7 39.5c-.1.1-.3.2-.5.2h-27.8l16.2-8.9c.2-.1.4-.2.6-.2h.1c.3 0 .5.1.7.2l11.4 6.2v.1zM43.7 8.5v15.5l-11.4-6.2c-.2-.1-.4-.2-.6-.2h-.1c-.3 0-.5.1-.7.2L15.4 31.9H4.3c-.2 0-.3-.1-.4-.2L19.4 12.5h24.3c.1 0 .2.1.3.2z"></path></svg>',
        facebook: '<svg fill="#65676B" viewBox="0 0 24 24" width="20" height="20"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>',
        linkedin: '<svg fill="#00000099" viewBox="0 0 24 24" width="20" height="20"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>',
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M36 20v-4c-3.31 0-6-2.69-6-6h-4v20c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6v-4c-5.52 0-10 4.48-10 10s4.48 10 10 10 10-4.48 10-10V16c2.48 1.53 5.39 2.44 8.5 2.44z"/></svg>'
    }
};

// Consent checkbox
document.getElementById('consentCheck').addEventListener('change', function() {
    document.getElementById('startBtn').disabled = !this.checked;
});

document.getElementById('startBtn').addEventListener('click', function() {
    document.getElementById('consentScreen').style.display = 'none';
    document.getElementById('demoScreen').style.display = 'block';
});

// Form validation
var demoFields = ['nameInput', 'ageInput', 'countryInput', 'incomeInput', 'genderInput', 'platformInput', 'freqInput'];

demoFields.forEach(function(id) {
    var el = document.getElementById(id);
    el.addEventListener('change', validateDemo);
    el.addEventListener('input', validateDemo);
});

function validateDemo() {
    var filled = demoFields.every(function(id) {
        return document.getElementById(id).value.trim() !== '';
    });
    document.getElementById('demoBtn').disabled = !filled;
}

// Anonymous checkbox
document.getElementById('anonCheck').addEventListener('change', function() {
    var nameInput = document.getElementById('nameInput');
    if (this.checked) {
        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        var id = 'ANON';
        for (var i = 0; i < 8; i++) {
            id += chars[Math.random() * chars.length];
        }
        nameInput.value = id;
        nameInput.readOnly = true;
    } else {
        nameInput.value = '';
        nameInput.readOnly = false;
    }
    validateDemo();
});

// Currency conversion
document.getElementById('countryInput').addEventListener('change', function() {
    var country = this.value;
    var label = document.getElementById('currLabel');
    var select = document.getElementById('incomeInput');
    
    select.innerHTML = '<option value="">Select income range</option>';
    
    var currData = {
        'AE': {curr: 'AED', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'SA': {curr: 'SAR', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'IN': {curr: 'INR', ranges: ['Under 25,000', '25,000-50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', 'Over 150,000']},
        'PK': {curr: 'PKR', ranges: ['Under 50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', '150,000-200,000', 'Over 200,000']},
        'UK': {curr: 'GBP', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'CA': {curr: 'CAD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'AU': {curr: 'AUD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'DE': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'FR': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']}
    };
    
    var info = currData[country] || {curr: 'USD', ranges: ['Under 2,000', '2,000-3,500', '3,500-5,000', '5,000-7,000', '7,000-10,000', 'Over 10,000']};
    label.textContent = '(' + info.curr + ')';
    
    info.ranges.forEach(function(r) {
        var opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        select.appendChild(opt);
    });
});

document.getElementById('demoBtn').addEventListener('click', function() {
    userData = {
        name: document.getElementById('nameInput').value,
        age: document.getElementById('ageInput').value,
        country: document.getElementById('countryInput').value,
        income: document.getElementById('incomeInput').value,
        gender: document.getElementById('genderInput').value,
        platform: document.getElementById('platformInput').value,
        frequency: document.getElementById('freqInput').value,
        anonymous: document.getElementById('anonCheck').checked
    };
    
    document.getElementById('demoScreen').style.display = 'none';
    document.getElementById('interfaceScreen').style.display = 'block';
});

// Interface selection
document.querySelectorAll('.interface-card').forEach(function(card) {
    card.addEventListener('click', function() {
        document.querySelectorAll('.interface-card').forEach(function(c) {
            c.classList.remove('selected');
        });
        this.classList.add('selected');
        selectedPlatform = this.dataset.platform;
        document.getElementById('interfaceBtn').disabled = false;
    });
});

document.getElementById('interfaceBtn').addEventListener('click', function() {
    document.getElementById('interfaceScreen').style.display = 'none';
    document.getElementById('surveyScreen').style.display = 'flex';
    initSurvey();
});

// Initialize survey
function initSurvey() {
    var feed = document.getElementById('feed');
    feed.innerHTML = '';
    feed.className = 'feed ' + selectedPlatform;
    
    document.getElementById('qTotal').textContent = questions.length;
    
    questions.forEach(function(q, idx) {
        var price = getPriceForCountry(q.price, userData.country);
        var imageGradient = productImages[idx % productImages.length];
        
        var post = document.createElement('div');
        post.className = 'post';
        post.dataset.index = idx;
        
        var actionsHTML = '';
        var iconSet = icons;

        if (selectedPlatform === 'tiktok') {
            actionsHTML = '<div class="post-actions">' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'like\')"><div class="action-icon">' + iconSet.like.tiktok + '</div><span>Like</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'comment\')"><div class="action-icon">' + iconSet.comment.tiktok + '</div><span>Comment</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'share\')"><div class="action-icon">' + iconSet.share.tiktok + '</div><span>Share</span></button>' +
                '<button class="action-btn buy-btn" onclick="answer(' + idx + ', \'buy\')"><span>Buy Now</span></button>' +
                '</div>';
        } else {
            actionsHTML = '<div class="post-actions">' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'like\')"><div class="action-icon">' + iconSet.like[selectedPlatform] + '</div><span>Like</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'comment\')"><div class="action-icon">' + iconSet.comment[selectedPlatform] + '</div><span>Comment</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'share\')"><div class="action-icon">' + iconSet.share[selectedPlatform] + '</div><span>Share</span></button>' +
                '<button class="action-btn buy-btn" onclick="answer(' + idx + ', \'buy\')">Buy Now</button>' +
                '</div>';
        }
        
        post.innerHTML = '<div class="post-header">' +
            '<div class="post-avatar">B</div>' +
            '<div class="post-info">' +
            '<div class="brand">BRAND</div>' +
            '<div class="time">2h ago</div>' +
            '</div>' +
            '</div>' +
            '<div class="post-image" style="background: ' + imageGradient + ';"></div>' +
            '<div class="post-content">' +
            '<div class="post-text">' + q.text + '</div>' +
            '<div class="post-price">' + price + '</div>' +
            '</div>' +
            actionsHTML;
        
        feed.appendChild(post);
    });
}

// Convert price based on country
function getPriceForCountry(usd, country) {
    var rates = {
        'AE': {r: 3.67, s: 'AED', after: true},
        'SA': {r: 3.75, s: 'SAR', after: true},
        'IN': {r: 83, s: '₹', after: false},
        'PK': {r: 280, s: 'PKR', after: true},
        'US': {r: 1, s: '$', after: false},
        'UK': {r: 0.79, s: '£', after: false},
        'CA': {r: 1.35, s: 'CAD $', after: false},
        'AU': {r: 1.50, s: 'AUD $', after: false},
        'DE': {r: 0.92, s: '€', after: false},
        'FR': {r: 0.92, s: '€', after: false}
    };
    
    var info = rates[country] || rates['US'];
    var amt = Math.round(usd * info.r);
    return info.after ? (amt + ' ' + info.s) : (info.s + amt);
}

// Answer question
function answer(idx, choice) {
    var now = Date.now();
    // Ensure answers array is initialized or large enough to prevent sparse array issues when counting
    if (!answers[idx]) {
        // Only record if not already recorded (i.e. first interaction)
        answers[idx] = {answer: choice, time: now - startTime};
        
        var post = document.querySelector('[data-index="' + idx + '"]');
        var btns = post.querySelectorAll('.action-btn');
        btns.forEach(function(b) {
            b.disabled = true;
        });
        
        updateProgress();
        
        var count = 0;
        for (var i = 0; i < questions.length; i++) {
            if (answers[i]) count++;
        }
        
        if (count === questions.length) {
            // Survey is complete, show results after a short delay
            setTimeout(showResults, 1000);
        } else if (idx < questions.length - 1) {
            // Scroll to the next post
            setTimeout(function() {
                var next = document.querySelector('[data-index="' + (idx + 1) + '"]');
                if (next) {
                    next.scrollIntoView({behavior: 'smooth', block: 'start'});
                }
            }, 500);
        }
    }
}

// Update progress
function updateProgress() {
    var count = 0;
    for (var i = 0; i < questions.length; i++) {
        if (answers[i]) count++;
    }
    var pct = (count / questions.length) * 100;
    document.getElementById('qNum').textContent = count + 1;
    document.getElementById('progFill').style.width = pct + '%';
}

// Show results
function showResults() {
    document.getElementById('surveyScreen').style.display = 'none';
    document.getElementById('resultsScreen').style.display = 'block';
    
    var totalTime = Math.floor((Date.now() - startTime) / 1000);
    var totalResponseTime = 0;
    for (var i = 0; i < answers.length; i++) {
        if (answers[i]) totalResponseTime += answers[i].time;
    }
    var avgTime = totalResponseTime / answers.length / 1000;
    
    document.getElementById('resultsBox').innerHTML = '<h3>Survey Data Summary</h3><p><strong>Platform Used:</strong> ' + selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1) + '</p><p><strong>Questions Answered:</strong> ' + questions.length + '</p><p><strong>Total Time Spent:</strong> ' + Math.floor(totalTime / 60) + 'm ' + String(totalTime % 60).padStart(2, '0') + 's</p><p><strong>Average Interaction Time:</strong> ' + avgTime.toFixed(1) + 's</p><p style="margin-top:16px;font-style:italic;">Detailed results will be downloaded. Thank you for contributing to fashion retail research!</p>';
}

// Download data
function downloadData() {
    var data = {
        demographics: userData,
        platform: selectedPlatform,
        answers: answers,
        totalTime: Date.now() - startTime,
        timestamp: new Date().toISOString()
    };
    
    // REPLACE 'YOUR_GOOGLE_SCRIPT_URL_HERE' WITH YOUR ACTUAL GOOGLE APPS SCRIPT URL
    fetch('YOUR_GOOGLE_SCRIPT_URL_HERE', {
        method: 'POST',
        mode: 'no-cors',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    }).catch(function(err) {
        console.log('Upload failed:', err);
    });
    
    // Also download locally as backup
    var blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'survey-' + userData.age + '-' + userData.gender + '-' + selectedPlatform + '-' + Date.now() + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
