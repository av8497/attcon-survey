<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Media Behaviour Survey</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    min-height: 100vh;
}

.screen {
    padding: 60px 40px;
    min-height: 100vh;
}

.screen h1 {
    font-size: 32px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 30px;
    text-align: center;
}

.screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 10px;
    text-align: center;
}

.screen-subtitle {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 25px 0 15px 0;
}

.screen p {
    font-size: 16px;
    line-height: 1.6;
    color: #4a4a4a;
    margin-bottom: 15px;
}

.screen ul {
    margin-left: 20px;
    margin-bottom: 20px;
}

.screen li {
    margin-bottom: 8px;
    font-size: 16px;
    color: #4a4a4a;
}

.consent-box {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.consent-box input[type="checkbox"] {
    margin-top: 3px;
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.consent-box label {
    font-size: 15px;
    line-height: 1.5;
    color: #4a4a4a;
    cursor: pointer;
}

.btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

.btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.demo-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.demo-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 1.5px solid #e1e5e9;
    border-radius: 8px;
    font-size: 15px;
    color: #1a1a1a;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.anon-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
}

.anon-checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.anon-checkbox label {
    font-size: 13px;
    color: #6a6a6a;
    font-weight: normal;
    margin: 0;
    cursor: pointer;
}

.interface-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.interface-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.interface-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 30px;
}

.interface-card {
    padding: 24px;
    border: 2px solid #e1e5e9;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.interface-card:hover {
    border-color: #667eea;
    transform: translateY(-2px);
}

.interface-card.selected {
    border-color: #667eea;
    background: #f8f9ff;
}

.interface-card .icon {
    font-size: 48px;
    margin-bottom: 12px;
}

.interface-card .name {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.interface-card .desc {
    font-size: 13px;
    color: #6a6a6a;
}

.survey-screen {
    display: none;
    flex-direction: column;
    min-height: 100vh;
}

.survey-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 16px 20px;
    position: sticky;
    top: 0;
    z-index: 100;
}

.survey-header .progress-text {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
}

.progress-bar {
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: white;
    width: 0%;
    transition: width 0.3s ease;
}

.feed {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 16px;
    background: #f8f9fa;
}

.post {
    background: white;
    border-radius: 12px;
    margin-bottom: 16px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.post-header {
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid #f0f0f0;
}

.post-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 18px;
}

.post-info .brand {
    font-size: 15px;
    font-weight: 600;
    color: #1a1a1a;
}

.post-info .time {
    font-size: 13px;
    color: #8a8a8a;
}

.post-image {
    width: 100%;
    height: 240px;
    background: linear-gradient(135deg, #f5f5f5, #e5e5e5);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #8a8a8a;
    font-size: 14px;
    font-weight: 500;
}

.post-content {
    padding: 16px;
}

.post-text {
    font-size: 15px;
    line-height: 1.5;
    color: #1a1a1a;
    margin-bottom: 12px;
}

.post-price {
    font-size: 22px;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 16px;
}

.post-actions {
    display: flex;
    gap: 8px;
    padding-top: 16px;
    border-top: 1px solid #f0f0f0;
}

.action-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.action-btn.like {
    background: #ff6b6b;
    color: white;
}

.action-btn.share {
    background: #51cf66;
    color: white;
}

.action-btn.follow {
    background: #667eea;
    color: white;
}

.action-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.results-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
    text-align: center;
}

.results-screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 20px;
}

.results-box {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: left;
}

.results-box h3 {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 16px;
}

.results-box p {
    font-size: 15px;
    color: #4a4a4a;
    margin-bottom: 8px;
}

@media (max-width: 768px) {
    .screen {
        padding: 30px 20px;
    }
    
    .demo-screen,
    .interface-screen {
        padding: 30px 20px;
    }
    
    .interface-grid {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>
<div class="container">
    <!-- Consent Screen -->
    <div class="screen" id="consentScreen">
        <h1>Social Media Behaviour Survey</h1>
        <p style="text-align:center;color:#4a4a4a;margin-bottom:30px;font-style:italic;line-height:1.8">"Congratulations! You've been invited to participate in research that contributes to the potentially groundbreaking understanding of what will go on to be known as The Attention-Conversion Paradox. I'd like to extend my sincerest gratitude to each and every participant. You're the best!" - Aman Vasandani, 2025</p>
        
        <h2 class="screen-subtitle">About This Research</h2>
        <p>This study examines how people interact with fashion content on different social media platforms. You'll experience realistic social feeds and can interact naturally.</p>
        
        <h2 class="screen-subtitle">What You'll Do</h2>
        <ul>
            <li>Answer a few background questions (2 minutes)</li>
            <li>Choose a social media platform style</li>
            <li>Browse through posts and interact naturally</li>
        </ul>
        
        <h2 class="screen-subtitle">Privacy & Data Use</h2>
        <p>Your responses are anonymous and used only for academic research. No personal information is stored or shared.</p>
        
        <div class="consent-box">
            <input type="checkbox" id="consentCheck">
            <label for="consentCheck">I understand this is academic research and consent to participate. I understand my responses are anonymous and used only for research purposes.</label>
        </div>
        
        <button class="btn" id="startBtn" disabled>Start Survey</button>
    </div>

    <!-- Demographics Screen -->
    <div class="demo-screen" id="demoScreen">
        <h2>About You</h2>
        <p>Help us understand shopping patterns across demographics</p>
        
        <div class="form-group">
            <label>Name</label>
            <input type="text" id="nameInput" placeholder="Your first name">
            <div class="anon-checkbox">
                <input type="checkbox" id="anonCheck">
                <label for="anonCheck">I'd like to be anonymous (generates random ID)</label>
            </div>
        </div>

        <div class="form-group">
            <label>Age Range</label>
            <select id="ageInput">
                <option value="">Select age range</option>
                <option value="18-24">18-24</option>
                <option value="25-29">25-29</option>
                <option value="30-34">30-34</option>
                <option value="35-39">35-39</option>
                <option value="40-44">40-44</option>
                <option value="45-50">45-50</option>
                <option value="50+">50+</option>
            </select>
        </div>

        <div class="form-group">
            <label>Country</label>
            <select id="countryInput">
                <option value="">Select country</option>
                <option value="AE">United Arab Emirates</option>
                <option value="SA">Saudi Arabia</option>
                <option value="IN">India</option>
                <option value="PK">Pakistan</option>
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
                <option value="CA">Canada</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="OTHER">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label>Monthly Income <span id="currLabel">(USD)</span></label>
            <select id="incomeInput">
                <option value="">Select income range</option>
            </select>
        </div>

        <div class="form-group">
            <label>Gender</label>
            <select id="genderInput">
                <option value="">Select gender</option>
                <option value="Female">Female</option>
                <option value="Male">Male</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Prefer not to say">Prefer not to say</option>
            </select>
        </div>

        <div class="form-group">
            <label>Primary Social Media Platform for Fashion</label>
            <select id="platformInput">
                <option value="">Select platform</option>
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
                <option value="Facebook">Facebook</option>
                <option value="Pinterest">Pinterest</option>
                <option value="YouTube">YouTube</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label>How often do you shop for fashion items?</label>
            <select id="freqInput">
                <option value="">Select frequency</option>
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="Quarterly">Every few months</option>
                <option value="Rarely">Rarely</option>
            </select>
        </div>

        <button class="btn" id="demoBtn" disabled>Continue to Platform Selection</button>
    </div>

    <!-- Interface Selection Screen -->
    <div class="interface-screen" id="interfaceScreen">
        <h2>Choose Your Experience</h2>
        <p>Select which social media interface style you'd like to experience:</p>
        
        <div class="interface-grid">
            <div class="interface-card" data-platform="facebook">
                <div class="icon">üìò</div>
                <div class="name">Facebook</div>
                <div class="desc">Detailed posts</div>
            </div>
            
            <div class="interface-card" data-platform="instagram">
                <div class="icon">üì∑</div>
                <div class="name">Instagram</div>
                <div class="desc">Visual-first</div>
            </div>
            
            <div class="interface-card" data-platform="linkedin">
                <div class="icon">üíº</div>
                <div class="name">LinkedIn</div>
                <div class="desc">Professional</div>
            </div>
            
            <div class="interface-card" data-platform="tiktok">
                <div class="icon">üéµ</div>
                <div class="name">TikTok</div>
                <div class="desc">Full-screen</div>
            </div>
        </div>
        
        <button class="btn" id="interfaceBtn" disabled>Start Experience</button>
    </div>

    <!-- Survey Screen -->
    <div class="survey-screen" id="surveyScreen">
        <div class="survey-header">
            <div class="progress-text">Question <span id="qNum">1</span> of <span id="qTotal">12</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progFill"></div>
            </div>
        </div>
        <div class="feed" id="feed"></div>
    </div>

    <!-- Results Screen -->
    <div class="results-screen" id="resultsScreen">
        <h2>Thank You!</h2>
        <div class="results-box" id="resultsBox"></div>
        <button class="btn" onclick="downloadData()">Download Results</button>
    </div>
</div>

<script>
// Global variables
var userData = {};
var selectedPlatform = '';
var answers = [];
var startTime = Date.now();

// 12 Survey questions
var questions = [
    {text: 'When you discover new brands on social media, which platforms make you feel most confident about their quality?', image: 'Cotton T-Shirt', price: 45, opts: {like: 'Visual platforms', share: 'Info-rich platforms', follow: 'Depends on brand'}},
    {text: 'Think about your last purchase discovered through social media. How many times did you see it before buying?', image: 'Eco Sneakers', price: 89, opts: {like: 'Saw everywhere', share: 'Friend recommended', follow: 'Price was right'}},
    {text: 'What is the biggest gap between what catches your attention online and what you actually purchase?', image: 'Designer Handbag', price: 156, opts: {like: 'Too expensive', share: 'Not practical', follow: 'Just browsing'}},
    {text: 'How do you balance quality vs quantity when shopping online?', image: 'White Shirt', price: 67, opts: {like: 'Quality always', share: 'Depends on item', follow: 'Quantity wins'}},
    {text: 'Do likes or comments on a fashion post influence your perception of whether it is worth buying?', image: 'Hoodie', price: 125, opts: {like: 'Very important', share: 'Somewhat matters', follow: 'Do not care'}},
    {text: 'When you see influencers or friends wearing something, does that make you more likely to buy it compared to ads?', image: 'Leggings', price: 78, opts: {like: 'Influencer yes', share: 'Friends yes', follow: 'Ads work fine'}},
    {text: 'Do you research products on multiple platforms before buying, or do you make impulse purchases?', image: 'Vintage Jacket', price: 95, opts: {like: 'Research first', share: 'Sometimes impulse', follow: 'Always impulse'}},
    {text: 'When buying accessories, do you prioritize brands you have seen multiple times on social media?', image: 'Watch', price: 189, opts: {like: 'Familiar brands', share: 'Open to new', follow: 'Mix of both'}},
    {text: 'Are you more likely to buy trending seasonal items or classic pieces that appear less frequently?', image: 'Summer Dress', price: 72, opts: {like: 'Trending items', share: 'Classic pieces', follow: 'Balanced mix'}},
    {text: 'Do promotional posts with discount codes make you more likely to buy immediately?', image: 'Sweatshirt Set', price: 85, opts: {like: 'Buy with code', share: 'Wait and watch', follow: 'Never use codes'}},
    {text: 'When you see the same product across multiple platforms, does that increase your trust in it?', image: 'Blazer', price: 145, opts: {like: 'Increases trust', share: 'Feels pushy', follow: 'No difference'}},
    {text: 'Final question: Which type of content makes you most likely to actually purchase?', image: 'Sneakers', price: 110, opts: {like: 'Influencer reviews', share: 'User-generated content', follow: 'Brand posts'}}
];

// Consent checkbox
document.getElementById('consentCheck').addEventListener('change', function() {
    document.getElementById('startBtn').disabled = !this.checked;
});

document.getElementById('startBtn').addEventListener('click', function() {
    document.getElementById('consentScreen').style.display = 'none';
    document.getElementById('demoScreen').style.display = 'block';
});

// Form validation
var demoFields = ['nameInput', 'ageInput', 'countryInput', 'incomeInput', 'genderInput', 'platformInput', 'freqInput'];

demoFields.forEach(function(id) {
    var el = document.getElementById(id);
    el.addEventListener('change', validateDemo);
    el.addEventListener('input', validateDemo);
});

function validateDemo() {
    var filled = demoFields.every(function(id) {
        return document.getElementById(id).value.trim() !== '';
    });
    document.getElementById('demoBtn').disabled = !filled;
}

// Anonymous checkbox
document.getElementById('anonCheck').addEventListener('change', function() {
    var nameInput = document.getElementById('nameInput');
    if (this.checked) {
        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        var id = 'ANON';
        for (var i = 0; i < 8; i++) {
            id += chars[Math.floor(Math.random() * chars.length)];
        }
        nameInput.value = id;
        nameInput.readOnly = true;
    } else {
        nameInput.value = '';
        nameInput.readOnly = false;
    }
    validateDemo();
});

// Currency conversion
document.getElementById('countryInput').addEventListener('change', function() {
    var country = this.value;
    var label = document.getElementById('currLabel');
    var select = document.getElementById('incomeInput');
    
    select.innerHTML = '<option value="">Select income range</option>';
    
    var currData = {
        'AE': {curr: 'AED', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'SA': {curr: 'SAR', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'IN': {curr: 'INR', ranges: ['Under 25,000', '25,000-50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', 'Over 150,000']},
        'PK': {curr: 'PKR', ranges: ['Under 50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', '150,000-200,000', 'Over 200,000']},
        'UK': {curr: 'GBP', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'CA': {curr: 'CAD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'AU': {curr: 'AUD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'DE': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'FR': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']}
    };
    
    var info = currData[country] || {curr: 'USD', ranges: ['Under 2,000', '2,000-3,500', '3,500-5,000', '5,000-7,000', '7,000-10,000', 'Over 10,000']};
    label.textContent = '(' + info.curr + ')';
    
    info.ranges.forEach(function(r) {
        var opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        select.appendChild(opt);
    });
});

document.getElementById('demoBtn').addEventListener('click', function() {
    userData = {
        name: document.getElementById('nameInput').value,
        age: document.getElementById('ageInput').value,
        country: document.getElementById('countryInput').value,
        income: document.getElementById('incomeInput').value,
        gender: document.getElementById('genderInput').value,
        platform: document.getElementById('platformInput').value,
        frequency: document.getElementById('freqInput').value,
        anonymous: document.getElementById('anonCheck').checked
    };
    
    document.getElementById('demoScreen').style.display = 'none';
    document.getElementById('interfaceScreen').style.display = 'block';
});

// Interface selection
document.querySelectorAll('.interface-card').forEach(function(card) {
    card.addEventListener('click', function() {
        document.querySelectorAll('.interface-card').forEach(function(c) {
            c.classList.remove('selected');
        });
        this.classList.add('selected');
        selectedPlatform = this.dataset.platform;
        document.getElementById('interfaceBtn').disabled = false;
    });
});

document.getElementById('interfaceBtn').addEventListener('click', function() {
    document.getElementById('interfaceScreen').style.display = 'none';
    document.getElementById('surveyScreen').style.display = 'flex';
    initSurvey();
});

// Initialize survey
function initSurvey() {
    var feed = document.getElementById('feed');
    feed.innerHTML = '';
    
    document.getElementById('qTotal').textContent = questions.length;
    
    questions.forEach(function(q, idx) {
        var price = getPriceForCountry(q.price, userData.country);
        
        var post = document.createElement('div');
        post.className = 'post';
        post.dataset.index = idx;
        post.innerHTML = '<div class="post-header"><div class="post-avatar">B</div><div class="post-info"><div class="brand">BRAND</div><div class="time">2h ago</div></div></div><div class="post-image">' + q.image + '</div><div class="post-content"><div class="post-text">' + q.text + '</div><div class="post-price">' + price + '</div><div class="post-actions"><button class="action-btn like" onclick="answer(' + idx + ', \'like\')">‚ù§Ô∏è ' + q.opts.like + '</button><button class="action-btn share" onclick="answer(' + idx + ', \'share\')">üì§ ' + q.opts.share + '</button><button class="action-btn follow" onclick="answer(' + idx + ', \'follow\')">‚ûï ' + q.opts.follow + '</button></div></div>';
        feed.appendChild(post);
    });
}

// Convert price based on country
function getPriceForCountry(usd, country) {
    var rates = {
        'AE': {r: 3.67, s: 'AED', after: true},
        'SA': {r: 3.75, s: 'SAR', after: true},
        'IN': {r: 83, s: '‚Çπ', after: false},
        'PK': {r: 280, s: 'PKR', after: true},
        'US': {r: 1, s: '$', after: false},
        'UK': {r: 0.79, s: '¬£', after: false},
        'CA': {r: 1.35, s: 'CAD $', after: false},
        'AU': {r: 1.50, s: 'AUD $', after: false},
// Convert price based on country
function convertPrice(usd, country) {
    var rates = {
        'AE': {r: 3.67, s: 'AED', after: true},
        'SA': {r: 3.75, s: 'SAR', after: true},
        'IN': {r: 83, s: '‚Çπ', after: false},
        'PK': {r: 280, s: 'PKR', after: true},
        'US': {r: 1, s: ', after: false},
        'UK': {r: 0.79, s: '¬£', after: false},
        'CA': {r: 1.35, s: 'CAD , after: false},
        'AU': {r: 1.50, s: 'AUD , after: false},
        'DE': {r: 0.92, s: '‚Ç¨', after: false},
        'FR': {r: 0.92, s: '‚Ç¨', after: false}
    };
    
    var info = rates[country] || rates['US'];
    var amt = Math.round(usd * info.r);
    return info.after ? (amt + ' ' + info.s) : (info.s + amt);
}

// Answer question
function answer(idx, choice) {
    var now = Date.now();
    answers[idx] = {answer: choice, time: now - startTime};
    
    var post = document.querySelector('[data-index="' + idx + '"]');
    var btns = post.querySelectorAll('.action-btn');
    btns.forEach(function(b) {
        b.disabled = true;
    });
    
    var selected = post.querySelector('.' + choice);
    selected.style.transform = 'scale(1.15)';
    
    updateProgress();
    
    var count = 0;
    for (var i = 0; i < answers.length; i++) {
        if (answers[i]) count++;
    }
    
    if (count === questions.length) {
        setTimeout(showResults, 1000);
    } else if (idx < questions.length - 1) {
        setTimeout(function() {
            var next = document.querySelector('[data-index="' + (idx + 1) + '"]');
            if (next) {
                next.scrollIntoView({behavior: 'smooth', block: 'start'});
            }
        }, 500);
    }
}

// Update progress
function updateProgress() {
    var count = 0;
    for (var i = 0; i < answers.length; i++) {
        if (answers[i]) count++;
    }
    var pct = (count / questions.length) * 100;
    document.getElementById('qNum').textContent = count + 1;
    document.getElementById('progFill').style.width = pct + '%';
}

// Show results
function showResults() {
    document.getElementById('surveyScreen').style.display = 'none';
    document.getElementById('resultsScreen').style.display = 'block';
    
    var totalTime = Math.floor((Date.now() - startTime) / 1000);
    var totalResponseTime = 0;
    for (var i = 0; i < answers.length; i++) {
        if (answers[i]) totalResponseTime += answers[i].time;
    }
    var avgTime = totalResponseTime / answers.length / 1000;
    
    document.getElementById('resultsBox').innerHTML = '<h3>Survey Complete!</h3><p><strong>Platform:</strong> ' + selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1) + '</p><p><strong>Questions:</strong> ' + questions.length + '</p><p><strong>Total Time:</strong> ' + Math.floor(totalTime / 60) + ':' + String(totalTime % 60).padStart(2, '0') + '</p><p><strong>Average Response:</strong> ' + avgTime.toFixed(1) + 's</p><p style="margin-top:16px;font-style:italic;">Thank you for contributing to fashion retail research!</p>';
}

// Download data
function downloadData() {
    var data = {
        demographics: userData,
        platform: selectedPlatform,
        answers: answers,
        totalTime: Date.now() - startTime,
        timestamp: new Date().toISOString()
    };
    
    // REPLACE 'YOUR_GOOGLE_SCRIPT_URL_HERE' WITH YOUR ACTUAL GOOGLE APPS SCRIPT URL
    fetch('YOUR_GOOGLE_SCRIPT_URL_HERE', {
        method: 'POST',
        mode: 'no-cors',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    }).catch(function(err) {
        console.log('Upload failed:', err);
    });
    
    // Also download locally as backup
    var blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'survey-' + userData.age + '-' + userData.gender + '-' + selectedPlatform + '-' + Date.now() + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
