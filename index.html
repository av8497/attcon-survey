<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Media Behaviour Study</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    min-height: 100vh;
}

.screen {
    padding: 60px 40px;
    min-height: 100vh;
}

.screen h1 {
    font-size: 32px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 30px;
    text-align: center;
}

.screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 10px;
    text-align: center;
}

.screen-subtitle {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 25px 0 15px 0;
}

.screen p {
    font-size: 16px;
    line-height: 1.6;
    color: #4a4a4a;
    margin-bottom: 15px;
}

.screen ul {
    margin-left: 20px;
    margin-bottom: 20px;
}

.screen li {
    margin-bottom: 8px;
    font-size: 16px;
    color: #4a4a4a;
}

.consent-box {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.consent-box input[type="checkbox"] {
    margin-top: 3px;
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.consent-box label {
    font-size: 15px;
    line-height: 1.5;
    color: #4a4a4a;
    cursor: pointer;
}

.btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

.btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.demo-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.demo-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 1.5px solid #e1e5e9;
    border-radius: 8px;
    font-size: 15px;
    color: #1a1a1a;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.anon-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
}

.anon-checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.anon-checkbox label {
    font-size: 13px;
    color: #6a6a6a;
    font-weight: normal;
    margin: 0;
    cursor: pointer;
}

.interface-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.interface-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.interface-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 30px;
}

.interface-card {
    padding: 24px;
    border: 2px solid #e1e5e9;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.interface-card:hover {
    border-color: #667eea;
    transform: translateY(-2px);
}

.interface-card.selected {
    border-color: #667eea;
    background: #f8f9ff;
}

.interface-card .icon {
    font-size: 48px;
    margin-bottom: 12px;
}

.interface-card .name {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.interface-card .desc {
    font-size: 13px;
    color: #6a6a6a;
}

.survey-screen {
    display: none;
    flex-direction: column;
    min-height: 100vh;
}

.survey-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 16px 20px;
    position: sticky;
    top: 0;
    z-index: 100;
}

.survey-header .progress-text {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
}

.progress-bar {
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: white;
    width: 0%;
    transition: width 0.3s ease;
}

.feed {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 16px;
    background: #f8f9fa;
}

/* Platform-specific styling */
.feed.instagram {
    background: #fafafa;
}

.feed.facebook {
    background: #f0f2f5;
}

.feed.linkedin {
    background: #f3f2ef;
}

.feed.tiktok {
    background: #000;
}

/* Post cards */
.post {
    background: white;
    border-radius: 0;
    margin-bottom: 12px;
    overflow: hidden;
    position: relative; 
}

.instagram .post {
    border-radius: 0;
    border: 1px solid #dbdbdb;
    margin-bottom: 24px;
}

.facebook .post {
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    margin-bottom: 16px;
}

.linkedin .post {
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    margin-bottom: 8px;
}

.tiktok .post {
    border-radius: 0;
    margin-bottom: 0;
    border: none;
    min-height: 80vh; 
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
}

.post-header {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.tiktok .post-header {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 5;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 20px;
    padding: 8px 12px;
}

.post-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 16px;
    flex-shrink: 0;
}

.instagram .post-avatar {
    border: 2px solid #c13584;
    background: #fff;
    color: #1a1a1a;
    font-size: 14px;
    font-weight: 600;
    line-height: 0;
    box-shadow: 0 0 0 2px white;
}

.post-info .brand {
    font-size: 14px;
    font-weight: 600;
    color: #262626;
}

.post-info .time {
    font-size: 12px;
    color: #8e8e8e;
}

.tiktok .post-info .brand,
.tiktok .post-info .time {
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
}

.post-image {
    width: 100%;
    height: 300px;
    background-size: cover;
    background-position: center;
    position: relative;
}

.tiktok .post-image {
    height: 80vh;
}

.post-content {
    padding: 12px 16px;
}

.tiktok .post-content {
    padding: 12px 16px 80px 16px; 
    background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
    position: absolute;
    bottom: 0;
    width: 100%;
    z-index: 4;
    color: white;
}

.post-text {
    font-size: 14px;
    line-height: 1.5;
    color: #262626;
    margin-bottom: 12px;
    white-space: pre-wrap; 
}

.tiktok .post-text {
    color: white;
    font-size: 15px;
}

.post-price {
    font-size: 20px;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 12px;
}

.tiktok .post-price {
    color: white;
    font-size: 18px;
}

.post-promo {
    font-size: 12px;
    font-weight: 500;
    color: #8e8e8e;
    margin-bottom: 8px;
}

/* Action buttons - platform specific */
.post-actions {
    display: flex;
    gap: 16px;
    padding: 8px 16px;
    border-top: 1px solid #efefef;
}

.instagram .post-actions {
    border-top: none;
    padding: 6px 16px 12px;
    gap: 16px;
    justify-content: flex-start;
}

.facebook .post-actions {
    border-top: 1px solid #e4e6eb;
    padding: 4px 16px;
    justify-content: space-around;
}

.linkedin .post-actions {
    border-top: 1px solid #e0e0e0;
    padding: 4px 8px;
    justify-content: space-around;
}

.tiktok .post-actions {
    position: absolute;
    right: 12px;
    bottom: 120px;
    flex-direction: column;
    gap: 20px;
    border: none;
    padding: 0;
    z-index: 5;
}

.action-btn {
    background: none;
    border: none;
    padding: 8px 12px;
    font-size: 13px;
    font-weight: 500;
    color: #65676b;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.instagram .action-btn {
    padding: 4px;
    color: #262626;
    order: 1; 
}

.instagram .action-btn.buy-btn-container {
    margin-left: auto;
    order: 2;
    padding: 0;
}

.facebook .action-btn {
    flex: 1;
    justify-content: center;
    color: #65676b;
    order: 1;
}

.facebook .action-btn.buy-btn-container {
    flex-grow: 0;
    order: 2;
}

.linkedin .action-btn {
    flex: 1;
    justify-content: center;
    color: #00000099;
    order: 1;
}

.linkedin .action-btn.buy-btn-container {
    flex-grow: 0;
    order: 2;
}

.tiktok .action-btn {
    flex-direction: column;
    color: white;
    gap: 4px;
    font-size: 11px;
    padding: 0;
}

.tiktok .action-btn.buy-btn-container {
    position: absolute;
    bottom: 20px;
    left: 16px;
    width: auto;
    flex-direction: row;
    padding: 0;
}

.action-btn:hover:not(:disabled) {
    color: #667eea;
}

.instagram .action-btn:hover:not(:disabled) {
    opacity: 0.6;
}

.facebook .action-btn:hover:not(:disabled) {
    background: #f2f2f2;
    border-radius: 4px;
}

.linkedin .action-btn:hover:not(:disabled) {
    background: #f3f2ef;
    border-radius: 4px;
}

.tiktok .action-btn:hover:not(:disabled) {
    transform: scale(1.1);
}

.action-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.action-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.instagram .action-icon {
    width: 24px;
    height: 24px;
}

.tiktok .action-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
}

/* Buy Now button special styling */
.buy-btn {
    background: #667eea;
    color: white;
    border-radius: 6px;
    padding: 8px 16px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 80px;
}

.instagram .buy-btn {
    background: #0095f6;
    padding: 6px 12px;
    font-size: 13px;
}

.facebook .buy-btn {
    background: #1877f2;
}

.linkedin .buy-btn {
    background: #0a66c2;
}

.tiktok .buy-btn {
    background: #fe2c55;
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 14px;
    min-width: 60px;
}

.buy-btn:hover:not(:disabled) {
    opacity: 0.9;
}

.results-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
    text-align: center;
}

.results-screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 20px;
}

.results-box {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: left;
}

.results-box h3 {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 16px;
}

.results-box p {
    font-size: 15px;
    color: #4a4a4a;
    margin-bottom: 8px;
}

@media (max-width: 768px) {
    .container {
        max-width: 100%;
        margin: 0;
    }
    .screen {
        padding: 30px 20px;
    }
    
    .demo-screen,
    .interface-screen {
        padding: 30px 20px;
    }
    
    .interface-grid {
        grid-template-columns: 1fr;
    }

    .tiktok .post-image {
        height: 85vh;
    }
    .tiktok .post-actions {
        bottom: 80px;
    }
    .tiktok .post-content {
        padding-bottom: 50px;
    }
}
</style>
</head>
<body>
<div class="container">
    <div class="screen" id="consentScreen">
        <h1>Social Media Behaviour Study</h1>
        <p style="text-align:center;color:#4a4a4a;margin-bottom:30px;font-style:italic;line-height:1.8">"Congratulations! You've been invited to participate in research that contributes to the potentially groundbreaking understanding of what will go on to be known as The Attention-Conversion Paradox. I'd like to extend my sincerest gratitude to each and every participant. You're the best!" - Aman Vasandani, 2025</p>
        
        <h2 class="screen-subtitle">About This Research</h2>
        <p>This study examines how people **interact with different types of fashion content** on various social media platforms. You'll experience realistic social feeds and your interactions will be logged anonymously.</p>
        
        <h2 class="screen-subtitle">What You'll Do</h2>
        <ul>
            <li>Answer a few background questions (2 minutes)</li>
            <li>Choose a social media platform style</li>
            <li>**Browse through 15 posts and interact naturally** (like, comment, share, or click 'Buy Now').</li>
        </ul>
        
        <h2 class="screen-subtitle">Privacy & Data Use</h2>
        <p>Your responses are **anonymous** and used only for academic research. No personal information is stored or shared.</p>
        
        <div class="consent-box">
            <input type="checkbox" id="consentCheck">
            <label for="consentCheck">I understand this is academic research and consent to participate. I understand my responses are anonymous and used only for research purposes.</label>
        </div>
        
        <button class="btn" id="startBtn" disabled>Start Study</button>
    </div>

    <div class="demo-screen" id="demoScreen">
        <h2>About You</h2>
        <p>Help us understand shopping patterns across demographics</p>
        
        <div class="form-group">
            <label for="nameInput">Name</label>
            <input type="text" id="nameInput" placeholder="Your first name">
            <div class="anon-checkbox">
                <input type="checkbox" id="anonCheck">
                <label for="anonCheck">I'd like to be anonymous (generates random ID)</label>
            </div>
        </div>

        <div class="form-group">
            <label for="ageInput">Age Range</label>
            <select id="ageInput">
                <option value="">Select age range</option>
                <option value="18-24">18-24</option>
                <option value="25-29">25-29</option>
                <option value="30-34">30-34</option>
                <option value="35-39">35-39</option>
                <option value="40-44">40-44</option>
                <option value="45-50">45-50</option>
                <option value="50+">50+</option>
            </select>
        </div>

        <div class="form-group">
            <label for="countryInput">Country</label>
            <select id="countryInput">
                <option value="">Select country</option>
                <option value="AE">United Arab Emirates</option>
                <option value="SA">Saudi Arabia</option>
                <option value="IN">India</option>
                <option value="PK">Pakistan</option>
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
                <option value="CA">Canada</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="OTHER">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="incomeInput">Monthly Income <span id="currLabel">(USD)</span></label>
            <select id="incomeInput">
                <option value="">Select income range</option>
            </select>
        </div>

        <div class="form-group">
            <label for="genderInput">Gender</label>
            <select id="genderInput">
                <option value="">Select gender</option>
                <option value="Female">Female</option>
                <option value="Male">Male</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Prefer not to say">Prefer not to say</option>
            </select>
        </div>

        <div class="form-group">
            <label for="platformInput">Primary Social Media Platform for Fashion</label>
            <select id="platformInput">
                <option value="">Select platform</option>
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
                <option value="Facebook">Facebook</option>
                <option value="Pinterest">Pinterest</option>
                <option value="YouTube">YouTube</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="freqInput">How often do you shop for fashion items?</label>
            <select id="freqInput">
                <option value="">Select frequency</option>
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="Quarterly">Every few months</option>
                <option value="Rarely">Rarely</option>
            </select>
        </div>

        <button class="btn" id="demoBtn" disabled>Continue to Platform Selection</button>
    </div>

    <div class="interface-screen" id="interfaceScreen">
        <h2>Choose Your Experience</h2>
        <p>Select which social media interface style you'd like to experience:</p>
        
        <div class="interface-grid">
            <div class="interface-card" data-platform="facebook">
                <div class="icon">📘</div>
                <div class="name">Facebook</div>
                <div class="desc">Detailed posts</div>
            </div>
            
            <div class="interface-card" data-platform="instagram">
                <div class="icon">📷</div>
                <div class="name">Instagram</div>
                <div class="desc">Visual-first</div>
            </div>
            
            <div class="interface-card" data-platform="linkedin">
                <div class="icon">💼</div>
                <div class="name">LinkedIn</div>
                <div class="desc">Professional</div>
            </div>
            
            <div class="interface-card" data-platform="tiktok">
                <div class="icon">🎵</div>
                <div class="name">TikTok</div>
                <div class="desc">Full-screen</div>
            </div>
        </div>
        
        <button class="btn" id="interfaceBtn" disabled>Start Experience</button>
    </div>

    <div class="survey-screen" id="surveyScreen">
        <div class="survey-header">
            <div class="progress-text">Interacted with <span id="qNum">0</span> of <span id="qTotal">15</span> Posts</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progFill"></div>
            </div>
        </div>
        <div class="feed" id="feed"></div>
    </div>

    <div class="results-screen" id="resultsScreen">
        <h2>Thank You!</h2>
        <div class="results-box" id="resultsBox"></div>
        <p>The data has been collected. You may download a copy for your reference.</p>
        <button class="btn" onclick="downloadData()">Download Data Copy</button>
    </div>
</div>

<script>
// Global variables
var userData = {};
var selectedPlatform = '';
var answers = [];
var startTime = Date.now();

// --- Core Data: 15 Posts (6 Ads, 9 Content) ---
const TOTAL_POSTS = 15;

var allPostsData = [
    // --- AD POSTS (6) ---
    { id: 1, type: 'image', url: 'https://i.ibb.co/6y4jGkS/sharpwear-post.jpg', isAd: true, price: 45, brand: 'SharpWear', user: '@SharpWorkwear', avatar: 'S', 
        shortCaption: 'The essential white shirt, redefined for comfort.', 
        longCaption: "The cornerstone of any modern wardrobe: the perfect white shirt. We've redefined this essential piece using a new moisture-wicking, wrinkle-resistant fabric. Ideal for long days in the office or seamless transition to evening wear. Discover the intersection of classic style and performance technology in our new collection. #SharpWear #MensFashion" },
    
    { id: 2, type: 'image', url: 'https://i.ibb.co/3151g3g/sneakers-post.jpg', isAd: true, price: 89, brand: 'ZenithStyle', user: '@ZenithStyle', avatar: 'Z',
        shortCaption: 'Elevate your daily hustle. Crafted for performance, styled for the street. Limited drop.', 
        longCaption: "Step into tomorrow with the 'Velocity Runner' sneaker. Our design team focused on creating a shoe that excels in both form and function. Featuring responsive cushioning and a durable, light-weight mesh upper, these are built for the fast-paced modern professional. Pre-order is now open for this limited edition drop. Don't miss out on what critics are calling 'the most comfortable run-ready shoe of the year.' #ZenithStyle #Footwear" },

    { id: 3, type: 'gradient', url: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', isAd: true, price: 156, brand: 'CodeFit', user: '@CodeFitOfficial', avatar: 'C',
        shortCaption: 'A modern blazer that works for the office or the weekend. Versatility is key.', 
        longCaption: "The 'Apex' Blazer: a fundamental piece for bridging business and casual. Its lightweight, unstructured design means it travels beautifully and maintains its shape without effort. We believe professional wear shouldn't sacrifice comfort, which is why we included interior utility pockets and a 4-way stretch fabric. Shop now and use code **PROSTYLE** for 15% off. #CodeFit #ProfessionalWear" },

    { id: 4, type: 'image', url: 'https://i.ibb.co/R2J304R/denim-post.jpg', isAd: true, price: 67, brand: 'UrbanFlux', user: '@UrbanFlux', avatar: 'U',
        shortCaption: 'Perfect fit. Perfect wash. Perfect for every day.', 
        longCaption: "Finding the perfect pair of jeans is a quest. Our new 'True Comfort' line is engineered with four-way stretch denim that retains its shape all day long. Stop settling for less than perfect. Shop the collection and experience the difference in fit and feel. We guarantee these will be your new favorites. Limited stock on the 'Indigo Deep' wash. #UrbanFlux #DenimFit" },
        
    { id: 5, type: 'image', url: 'https://i.ibb.co/m0f245x/watch-post.jpg', isAd: true, price: 78, brand: 'Voyage Gear', user: '@VoyageGear', avatar: 'V',
        shortCaption: 'The everyday essential is back in stock. Shop before they sell out.', 
        longCaption: "Precision and rugged elegance define the 'Explorer' series. Designed for the adventurer who still needs to look sharp, this timepiece features a hardened mineral crystal and a genuine leather strap. It's water-resistant up to 100m. A reliable companion for your most demanding days. Secure yours today and get free express shipping for a limited time. #VoyageGear #GiftsForHim" },

    { id: 6, type: 'image', url: 'https://i.ibb.co/6y4jGkS/sharpwear-post.jpg', isAd: true, price: 95, brand: 'SharpWear', user: '@SharpWorkwear', avatar: 'S',
        shortCaption: 'Your wardrobe\'s secret weapon. Buy one, get 50% off the second.', 
        longCaption: "Introducing the 'Flex-Fit' shirt: the only work shirt you need. Engineered with two-way stretch fabric and a seamless construction, it guarantees comfort from your morning commute to your final meeting. Currently running a limited-time promotion: Buy One, Get the Second Half Price. Don't miss this opportunity to stock up on quality. Promotion ends Friday! #SharpWear #Workwear" },

    // --- CONTENT POSTS (9) ---
    { id: 7, type: 'gradient', url: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', isAd: false, brand: 'AuraThreads', user: '@AuraThreads', avatar: 'A',
        shortCaption: 'Cozy up in our best-selling hoodie! Double tap if you love this colour.', 
        longCaption: "Sunday morning vibes in the 'Vibrant Dusk' hoodie. Crafted from sustainable organic cotton, this plush piece is our number one seller for comfort and statement style. A reminder that quality leisurewear is an investment in your wellbeing. We focus on ethical production and minimizing waste in every thread. #AuraThreads #SustainableFashion" },

    { id: 8, type: 'image', url: 'https://i.ibb.co/R2J304R/denim-post.jpg', isAd: false, brand: 'UrbanFlux', user: '@UrbanFlux', avatar: 'U',
        shortCaption: 'Our new organic denim line is here. Sustainable style that lasts.', 
        longCaption: "Sustainability meets unparalleled quality in our new 'Eco-Wash' denim collection. Made with 100% organic cotton and processed using 90% less water than traditional methods, this is denim you can feel good about wearing. The perfect slim fit, available in three washes. Invest in pieces that last—for your closet and the planet. #UrbanFlux #EcoDenim" },

    { id: 9, type: 'gradient', url: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', isAd: false, brand: 'VelvetEdge', user: '@VelvetEdge', avatar: 'V',
        shortCaption: 'Feeling the pink energy. This vibrant dress is perfect for a summer evening.', 
        longCaption: "Introducing the 'Sunset Bloom' midi dress. The perfect blend of vibrant color and comfortable, flowing structure. Made with breathable silk-blend fabric, this dress is guaranteed to turn heads and keep you cool. It's the ideal choice for summer events and destination wear. The design is inspired by vibrant Moroccan sunsets. #VelvetEdge #SummerStyle" },

    { id: 10, type: 'gradient', url: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', isAd: false, brand: 'Iconic Basics', user: '@IconicBasics', avatar: 'I',
        shortCaption: 'Dark, sleek, and timeless. The only backpack you\'ll ever need.', 
        longCaption: "Introducing the 'Shadow Pro' backpack. Designed for the creative commuter, this bag features a dedicated padded laptop sleeve, water-resistant exterior, and smart organizational pockets. Its minimalist aesthetic ensures it complements both professional attire and casual street style. We built it with military-grade cordura for ultimate longevity. #IconicBasics #TechWear" },

    { id: 11, type: 'image', url: 'https://i.ibb.co/6y4jGkS/sharpwear-post.jpg', isAd: false, brand: 'SharpWear', user: '@SharpWorkwear', avatar: 'S',
        shortCaption: 'Styling the classics. Always professional, always comfortable.', 
        longCaption: "A look inside the design studio: we believe in building wardrobes around timeless essentials. This linen-blend shirt offers a breathable texture and an impeccably clean silhouette, proving that simplicity is the ultimate sophistication. Our goal is to create clothes that reduce decision fatigue. #SharpWear #StyleTips" },
        
    { id: 12, type: 'image', url: 'https://i.ibb.co/3151g3g/sneakers-post.jpg', isAd: false, brand: 'ZenithStyle', user: '@ZenithStyle', avatar: 'Z',
        shortCaption: 'Weekend ready. Which adventure are you choosing in these kicks?', 
        longCaption: "Our 'Trailblazer' model isn't just for running; it's engineered for life's adventures. Featuring a Vibram sole for superior grip and a recycled polymer upper, this shoe is built to handle tough terrain while keeping a minimal profile. We believe in gear that keeps up with you, whether you're climbing mountains or city blocks. #ZenithStyle #AdventureTime" },
        
    { id: 13, type: 'gradient', url: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)', isAd: false, brand: 'Pinnacle Look', user: '@PinnacleLook', avatar: 'P',
        shortCaption: 'Soft hues for a soft launch. Discover our new spring line.',
        longCaption: "Our new spring collection is all about soft transitions and sophisticated comfort. These new knits use a luxurious merino wool blend that is both light and warm. Perfect for layering as the weather changes. We’ve meticulously chosen a palette designed to be mix-and-match compatible across the entire line, ensuring maximum utility. #PinnacleLook #NewArrivals" },
        
    { id: 14, type: 'image', url: 'https://i.ibb.co/R2J304R/denim-post.jpg', isAd: false, brand: 'UrbanFlux', user: '@UrbanFlux', avatar: 'U',
        shortCaption: 'Denim on denim is always a win. Shop the full look.',
        longCaption: "The Canadian Tuxedo, elevated. This season, we're embracing the head-to-toe denim look with pieces that offer varied textures and shades. It's a bold look that speaks to confident personal style. We've sourced the best quality Japanese selvedge denim for this line, guaranteeing a comfortable yet rigid structure. #UrbanFlux #DenimStyle" },
        
    { id: 15, type: 'image', url: 'https://i.ibb.co/m0f245x/watch-post.jpg', isAd: false, brand: 'Voyage Gear', user: '@VoyageGear', avatar: 'V',
        shortCaption: 'Behind the scenes: The making of a classic.', 
        longCaption: "A look inside our manufacturing process. Every component of our 'Legacy Chrono' is hand-inspected for quality and durability. We believe in transparent luxury—showing you the effort and precision that goes into a timeless piece. We're proud to uphold the traditions of fine watchmaking while utilizing modern, sustainable materials. #VoyageGear #WatchMaking" }
];

// --- Fictional brand names and user data (for random post assignment) ---
var brandData = allPostsData.map(p => ({brand: p.brand, user: p.user, avatar: p.avatar}));

// SVG icons (Remains the same as before)
var icons = {
    like: {
        instagram: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>',
        facebook: '<svg fill="currentColor" viewBox="0 0 48 48" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4.5H8.5V12h2.5V9.5h2V12h2.5v.5H13v4.5h-2z"/></svg>',
        linkedin: '<svg fill="currentColor" viewBox="0 0 48 48" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14h2v-6h-2v6zm-1-7h4v-2h-4v2z"/></svg>',
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M34.6 6.1c-1.6 0-2.9 1.3-2.9 2.9v20.3c0 6.4-5.2 11.6-11.6 11.6s-11.6-5.2-11.6-11.6 5.2-11.6 11.6-11.6c.3 0 .7 0 1 .1v-5.2c-.3 0-.7-.1-1-.1-9.2 0-16.7 7.5-16.7 16.7S10.9 46 20.1 46s16.7-7.5 16.7-16.7V15.8c2.6 1.9 5.8 3 9.2 3V13.6c-5.8 0-10.5-4.7-10.5-10.5h-5.1z"/></svg>'
    },
    comment: {
        instagram: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>',
        facebook: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2zm0-10h2v6h-2z"/></svg>',
        linkedin: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2zm0-10h2v6h-2z"/></svg>',
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm-2-6h4v4h-4zm0-16h4v12h-4z"/></svg>'
    },
    share: {
        instagram: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>',
        facebook: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>',
        linkedin: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>',
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M36 20v-4c-3.31 0-6-2.69-6-6h-4v20c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6v-4c-5.52 0-10 4.48-10 10s4.48 10 10 10 10-4.48 10-10V16c2.48 1.53 5.39 2.44 8.5 2.44z"/></svg>'
    }
};


// --- INITIALIZATION AND DEMOGRAPHICS ---

// Consent checkbox
document.getElementById('consentCheck').addEventListener('change', function() {
    document.getElementById('startBtn').disabled = !this.checked;
});

document.getElementById('startBtn').addEventListener('click', function() {
    document.getElementById('consentScreen').style.display = 'none';
    document.getElementById('demoScreen').style.display = 'block';
});

// Form validation
var demoFields = ['nameInput', 'ageInput', 'countryInput', 'incomeInput', 'genderInput', 'platformInput', 'freqInput'];

demoFields.forEach(function(id) {
    var el = document.getElementById(id);
    el.addEventListener('change', validateDemo);
    el.addEventListener('input', validateDemo);
});

function validateDemo() {
    var filled = demoFields.every(function(id) {
        return document.getElementById(id).value.trim() !== '';
    });
    document.getElementById('demoBtn').disabled = !filled;
}

// Anonymous checkbox
document.getElementById('anonCheck').addEventListener('change', function() {
    var nameInput = document.getElementById('nameInput');
    if (this.checked) {
        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        var id = 'ANON-';
        for (var i = 0; i < 8; i++) {
            id += chars[Math.floor(Math.random() * chars.length)];
        }
        nameInput.value = id;
        nameInput.readOnly = true;
    } else {
        nameInput.value = '';
        nameInput.readOnly = false;
    }
    validateDemo();
});

// Currency conversion
document.getElementById('countryInput').addEventListener('change', function() {
    var country = this.value;
    var label = document.getElementById('currLabel');
    var select = document.getElementById('incomeInput');
    
    select.innerHTML = '<option value="">Select income range</option>';
    
    var currData = {
        'AE': {curr: 'AED', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'SA': {curr: 'SAR', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'IN': {curr: 'INR', ranges: ['Under 25,000', '25,000-50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', 'Over 150,000']},
        'PK': {curr: 'PKR', ranges: ['Under 50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', '150,000-200,000', 'Over 200,000']},
        'UK': {curr: 'GBP', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'CA': {curr: 'CAD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'AU': {curr: 'AUD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'DE': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'FR': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']}
    };
    
    var info = currData[country] || {curr: 'USD', ranges: ['Under 2,000', '2,000-3,500', '3,500-5,000', '5,000-7,000', '7,000-10,000', 'Over 10,000']};
    label.textContent = '(' + info.curr + ')';
    
    info.ranges.forEach(function(r) {
        var opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        select.appendChild(opt);
    });
    validateDemo(); 
});

document.getElementById('demoBtn').addEventListener('click', function() {
    userData = {
        name: document.getElementById('nameInput').value,
        age: document.getElementById('ageInput').value,
        country: document.getElementById('countryInput').value,
        income: document.getElementById('incomeInput').value,
        gender: document.getElementById('genderInput').value,
        platform: document.getElementById('platformInput').value,
        frequency: document.getElementById('freqInput').value,
        anonymous: document.getElementById('anonCheck').checked
    };
    
    document.getElementById('demoScreen').style.display = 'none';
    document.getElementById('interfaceScreen').style.display = 'block';
});

// Interface selection
document.querySelectorAll('.interface-card').forEach(function(card) {
    card.addEventListener('click', function() {
        document.querySelectorAll('.interface-card').forEach(function(c) {
            c.classList.remove('selected');
        });
        this.classList.add('selected');
        selectedPlatform = this.dataset.platform;
        document.getElementById('interfaceBtn').disabled = false;
    });
});

document.getElementById('interfaceBtn').addEventListener('click', function() {
    document.getElementById('interfaceScreen').style.display = 'none';
    document.getElementById('surveyScreen').style.display = 'flex';
    initSurvey();
});

// Utility function to shuffle array
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// --- SURVEY/FEED LOGIC ---

function initSurvey() {
    // Shuffle the posts (all 15 posts are now in allPostsData)
    shuffleArray(allPostsData);

    var feed = document.getElementById('feed');
    feed.innerHTML = '';
    feed.className = 'feed ' + selectedPlatform;
    
    document.getElementById('qTotal').textContent = TOTAL_POSTS;
    
    allPostsData.forEach(function(postData, idx) {
        
        var priceText = postData.isAd ? getPriceForCountry(postData.price, userData.country) : '';
        var postCaption = (selectedPlatform === 'facebook' || selectedPlatform === 'linkedin') ? 
                          postData.longCaption : 
                          postData.shortCaption;

        var imageStyle = postData.type === 'image' ? 'background-image: url("' + postData.url + '");' : 'background: ' + postData.url + ';';
        
        var post = document.createElement('div');
        post.className = 'post';
        post.dataset.index = idx;
        post.dataset.postId = postData.id; 
        post.dataset.isAd = postData.isAd;
        
        var timeText = selectedPlatform === 'facebook' ? 'Sponsored · 2h' : '2h ago';
        
        // --- 1. Header Logic ---
        var postHeaderHTML = '';
        var sponsoredTag = postData.isAd ? 
                           (selectedPlatform === 'facebook' ? ' <span style="font-weight: normal; color: #606770;">· Sponsored</span>' : 
                            selectedPlatform === 'linkedin' ? ' <span style="font-size:12px;color:#00000099;">• Sponsored</span>' : '') 
                           : '';
        
        if (selectedPlatform === 'tiktok') {
             // TikTok overlay header
             postHeaderHTML = '<div class="post-header">' +
                '<div class="post-avatar">' + postData.avatar + '</div>' +
                '<div class="post-info">' +
                '<div class="brand">' + postData.user + (postData.isAd ? ' <span style="font-weight: normal; color: #ccc;">• Sponsored</span>' : '') + '</div>' +
                '</div>' +
                '</div>';

        } else if (selectedPlatform === 'instagram') {
            postHeaderHTML = '<div class="post-header">' +
                '<div class="post-avatar">' + postData.avatar + '</div>' +
                '<div class="post-info">' +
                '<div class="brand">' + postData.user + '</div>' +
                '<div class="time">' + timeText + (postData.isAd ? ' • Sponsored' : '') + '</div>' +
                '</div>' +
                '</div>';
        } else { // Facebook, LinkedIn
            postHeaderHTML = '<div class="post-header">' +
                '<div class="post-avatar">' + postData.avatar + '</div>' +
                '<div class="post-info">' +
                '<div class="brand">' + postData.brand + sponsoredTag + '</div>' +
                '<div class="time">' + timeText + '</div>' +
                '</div>' +
                '</div>';
        }

        // --- 2. Action Logic (Buy Button vs. Standard Actions) ---
        var buyBtnHTML = postData.isAd ? 
            (selectedPlatform === 'tiktok' ? '<div class="action-btn buy-btn-container" onclick="answer(' + idx + ', \'buy\')"><button class="buy-btn">Shop Now</button></div>' :
             '<button class="action-btn buy-btn-container" onclick="answer(' + idx + ', \'buy\')"><button class="buy-btn">Buy Now</button></button>') :
            '';

        var standardActionsHTML = 
                '<button class="action-btn" onclick="answer(' + idx + ', \'like\')"><div class="action-icon">' + icons.like[selectedPlatform] + '</div>' + (selectedPlatform !== 'instagram' && selectedPlatform !== 'tiktok' ? '<span>Like</span>' : '') + '</button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'comment\')"><div class="action-icon">' + icons.comment[selectedPlatform] + '</div>' + (selectedPlatform !== 'instagram' && selectedPlatform !== 'tiktok' ? '<span>Comment</span>' : '') + '</button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'share\')"><div class="action-icon">' + icons.share[selectedPlatform] + '</div>' + (selectedPlatform !== 'instagram' && selectedPlatform !== 'tiktok' ? '<span>Share</span>' : '') + '</button>';

        var actionsHTML = '';
        if (selectedPlatform === 'tiktok') {
            actionsHTML = '<div class="post-actions">' + standardActionsHTML + '</div>' + buyBtnHTML;
        } else if (selectedPlatform === 'instagram') {
            actionsHTML = '<div class="post-actions">' + standardActionsHTML + buyBtnHTML + '</div>';
        } else { // Facebook, LinkedIn
            actionsHTML = '<div class="post-actions">' + standardActionsHTML + buyBtnHTML + '</div>';
        }

        // --- 3. Content Logic ---
        var contentPrePrice = selectedPlatform === 'instagram' ? 
            '<div class="post-text" style="font-size:14px; color:#4a4a4a; margin-top:4px; margin-bottom:0;"><strong>' + postData.user + '</strong> ' + postCaption + '</div>' :
            '<div class="post-text" style="margin-bottom:' + (postData.isAd ? '12px' : '0px') + ';"><strong>' + postData.brand + '</strong> ' + postCaption + '</div>';

        var contentPrice = postData.isAd ? 
            '<div class="post-price" style="margin-top:' + (selectedPlatform === 'instagram' ? '8px' : '12px') + ';">' + priceText + '</div>' :
            '';
            
        var postContentHTML = selectedPlatform === 'tiktok' ?
            '<div class="post-content">' +
                '<div class="post-text" style="color:white; font-weight:600;">' + postData.user + '</div>' +
                '<div class="post-text" style="color:white; margin-bottom:5px;">' + postCaption + '</div>' +
                (postData.isAd ? '<div class="post-promo" style="color:yellow;">' + priceText + ' • Shop Now</div>' : '') +
            '</div>' : 
            
            '<div class="post-content" style="padding-top:0;">' + 
                (selectedPlatform !== 'instagram' ? contentPrePrice : '') + // FB/LI Caption
                contentPrice +
                (selectedPlatform === 'instagram' ? contentPrePrice : '') + // IG Caption is below the price/actions
            '</div>';
        
        // --- 4. Final Assembly ---
        if (selectedPlatform === 'tiktok') {
            post.innerHTML = 
                '<div class="post-image" style="' + imageStyle + '"></div>' +
                postHeaderHTML + 
                postContentHTML + 
                actionsHTML;
        } else if (selectedPlatform === 'instagram') {
            post.innerHTML = 
                postHeaderHTML +
                '<div class="post-image" style="' + imageStyle + '"></div>' +
                actionsHTML + 
                postContentHTML; // Content goes after actions on IG
        } else { // Facebook, LinkedIn
            post.innerHTML = 
                postHeaderHTML +
                '<div class="post-image" style="' + imageStyle + '"></div>' +
                postContentHTML +
                actionsHTML;
        }
        
        feed.appendChild(post);
    });
}

// Convert price based on country
function getPriceForCountry(usd, country) {
    var rates = {
        'AE': {r: 3.67, s: 'AED', after: true},
        'SA': {r: 3.75, s: 'SAR', after: true},
        'IN': {r: 83, s: '₹', after: false},
        'PK': {r: 280, s: 'PKR', after: true},
        'US': {r: 1, s: '$', after: false},
        'UK': {r: 0.79, s: '£', after: false},
        'CA': {r: 1.35, s: 'CAD $', after: false},
        'AU': {r: 1.50, s: 'AUD $', after: false},
        'DE': {r: 0.92, s: '€', after: false},
        'FR': {r: 0.92, s: '€', after: false}
    };
    
    var info = rates[country] || rates['US'];
    var amt = Math.round(usd * info.r);
    return info.after ? (amt + ' ' + info.s) : (info.s + amt);
}

// Answer question
function answer(idx, choice) {
    var now = Date.now();
    var post = document.querySelector('[data-index="' + idx + '"]');

    // Prevent re-answering a post
    if (answers.some(a => a.post_index === idx)) return;

    answers.push({
        post_id: parseInt(post.dataset.postId), 
        post_index: idx,
        platform: selectedPlatform,
        is_ad: post.dataset.isAd === 'true',
        action: choice,
        time_ms: now - startTime
    });

    var btns = post.querySelectorAll('.action-btn button:not(.buy-btn)');
    
    // Disable all actions for this post
    btns.forEach(function(b) {
        b.disabled = true;
    });
    
    // Disable the buy button specifically
    var buyBtn = post.querySelector('.buy-btn');
    if (buyBtn) buyBtn.disabled = true;

    // Highlight the selected action
    var chosenBtnContainer = post.querySelector('.action-btn[onclick*="' + choice + '"]');
    if (chosenBtnContainer) {
        chosenBtnContainer.style.opacity = '1.0';
        chosenBtnContainer.style.color = selectedPlatform === 'tiktok' ? '#fe2c55' : '#667eea';
        chosenBtnContainer.style.fontWeight = 'bold';
    }

    updateProgress();
    
    // Check for survey completion
    if (answers.length === TOTAL_POSTS) {
        setTimeout(showResults, 1000);
    } else {
        // Scroll to the next post that hasn't been interacted with
        setTimeout(function() {
            var nextUnanswered = document.querySelector('.post:not(.answered)');
            if (nextUnanswered) {
                nextUnanswered.scrollIntoView({behavior: 'smooth', block: 'start'});
            }
        }, 500);
    }
}

// Update progress
function updateProgress() {
    var count = answers.length;
    var pct = (count / TOTAL_POSTS) * 100;
    document.getElementById('qNum').textContent = count;
    document.getElementById('progFill').style.width = pct + '%';
}

// Show results
function showResults() {
    document.getElementById('surveyScreen').style.display = 'none';
    document.getElementById('resultsScreen').style.display = 'block';
    
    var totalTime = Math.floor((Date.now() - startTime) / 1000);
    var adInteractions = answers.filter(a => a.is_ad && a.action !== 'buy').length;
    var buyClicks = answers.filter(a => a.action === 'buy').length;
    
    document.getElementById('resultsBox').innerHTML = 
        '<h3>Study Metrics</h3>' +
        '<p><strong>Platform:</strong> ' + selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1) + '</p>' +
        '<p><strong>Total Posts:</strong> ' + TOTAL_POSTS + '</p>' +
        '<p><strong>Total Interactions:</strong> ' + answers.length + '</p>' +
        '<p><strong>Buy Clicks:</strong> ' + buyClicks + ' / 6 Ads</p>' +
        '<p><strong>Total Time:</strong> ' + Math.floor(totalTime / 60) + ':' + String(totalTime % 60).padStart(2, '0') + '</p>' +
        '<p style="margin-top:16px;font-style:italic;">Thank you for contributing to fashion retail research!</p>';
}

// Download data
function downloadData() {
    var data = {
        demographics: userData,
        platform: selectedPlatform,
        answers: answers,
        totalTime_ms: Date.now() - startTime,
        timestamp: new Date().toISOString()
    };
    
    // !!! IMPORTANT: Paste your actual Google Apps Script URL here !!!
    const SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'; // <--- CHANGE THIS LINE!

    if (SCRIPT_URL && SCRIPT_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', 
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(res => console.log('Upload attempted to Google Script')).catch(err => {
            console.error('Google Script upload failed:', err);
        });
    } else {
        console.warn("Google Apps Script URL is missing! Data only downloaded locally.");
    }
    
    // Also download locally as backup
    var blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'survey-' + userData.name.replace(/[^a-zA-Z0-9]/g, '') + '-' + selectedPlatform + '-' + Date.now() + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
