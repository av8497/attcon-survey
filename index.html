<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Media Behaviour Survey</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    min-height: 100vh;
}

.screen {
    padding: 60px 40px;
    min-height: 100vh;
}

.screen h1 {
    font-size: 32px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 30px;
    text-align: center;
}

.screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 10px;
    text-align: center;
}

.screen-subtitle {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 25px 0 15px 0;
}

.screen p {
    font-size: 16px;
    line-height: 1.6;
    color: #4a4a4a;
    margin-bottom: 15px;
}

.screen ul {
    margin-left: 20px;
    margin-bottom: 20px;
}

.screen li {
    margin-bottom: 8px;
    font-size: 16px;
    color: #4a4a4a;
}

.consent-box {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.consent-box input[type="checkbox"] {
    margin-top: 3px;
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.consent-box label {
    font-size: 15px;
    line-height: 1.5;
    color: #4a4a4a;
    cursor: pointer;
}

.btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

.btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.demo-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.demo-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 24px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 1.5px solid #e1e5e9;
    border-radius: 8px;
    font-size: 15px;
    color: #1a1a1a;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.anon-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
}

.anon-checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.anon-checkbox label {
    font-size: 13px;
    color: #6a6a6a;
    font-weight: normal;
    margin: 0;
    cursor: pointer;
}

.interface-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
}

.interface-screen > p {
    font-size: 15px;
    color: #6a6a6a;
    text-align: center;
    margin-bottom: 30px;
}

.interface-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-bottom: 30px;
}

.interface-card {
    padding: 24px;
    border: 2px solid #e1e5e9;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.interface-card:hover {
    border-color: #667eea;
    transform: translateY(-2px);
}

.interface-card.selected {
    border-color: #667eea;
    background: #f8f9ff;
}

.interface-card .icon {
    font-size: 48px;
    margin-bottom: 12px;
}

.interface-card .name {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.interface-card .desc {
    font-size: 13px;
    color: #6a6a6a;
}

.survey-screen {
    display: none;
    flex-direction: column;
    min-height: 100vh;
}

.survey-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 16px 20px;
    position: sticky;
    top: 0;
    z-index: 100;
}

.survey-header .progress-text {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
}

.progress-bar {
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: white;
    width: 0%;
    transition: width 0.3s ease;
}

.feed {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 16px;
    background: #f8f9fa;
}

/* Platform-specific styling */
.feed.instagram {
    background: #fafafa;
}

.feed.facebook {
    background: #f0f2f5;
}

.feed.linkedin {
    background: #f3f2ef;
}

.feed.tiktok {
    background: #000;
}

/* Post cards */
.post {
    background: white;
    border-radius: 0;
    margin-bottom: 12px;
    overflow: hidden;
    position: relative; /* Added for TikTok positioning */
}

.instagram .post {
    border-radius: 0;
    border: 1px solid #dbdbdb;
    margin-bottom: 24px;
}

.facebook .post {
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    margin-bottom: 16px;
}

.linkedin .post {
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    margin-bottom: 8px;
}

.tiktok .post {
    border-radius: 0;
    margin-bottom: 0;
    border: none;
    height: 100vh; /* Make TikTok post fill screen */
}

.post-header {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.tiktok .post-header {
    position: absolute;
    top: 16px;
    left: 0;
    z-index: 10;
    width: 80%;
    color: white;
}

.post-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 16px;
}

.instagram .post-avatar {
    border: 2px solid #c13584;
}

.tiktok .post-avatar {
    background: white;
    color: #667eea;
}

.post-info .brand {
    font-size: 14px;
    font-weight: 600;
    color: #262626;
}

.tiktok .post-info .brand,
.tiktok .post-info .time {
    color: white;
}


.post-info .time {
    font-size: 12px;
    color: #8e8e8e;
}

.post-image {
    width: 100%;
    height: 300px;
    background-size: cover;
    background-position: center;
    position: relative;
}

.tiktok .post-image {
    height: 100%; /* Fill the entire post container */
}

.post-content {
    padding: 12px 16px;
}

.post-text {
    font-size: 14px;
    line-height: 1.5;
    color: #262626;
    margin-bottom: 12px;
}

.post-price {
    font-size: 20px;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 12px;
}

/* Action buttons - platform specific */
.post-actions {
    display: flex;
    gap: 16px;
    padding: 8px 16px;
    border-top: 1px solid #efefef;
}

.instagram .post-actions {
    border-top: none;
    padding: 6px 16px 12px;
    gap: 16px;
}

.facebook .post-actions {
    border-top: 1px solid #e4e6eb;
    padding: 4px 16px;
    justify-content: space-around;
}

.linkedin .post-actions {
    border-top: 1px solid #e0e0e0;
    padding: 4px 8px;
    justify-content: space-around;
}

.tiktok .post-actions {
    position: absolute;
    right: 12px;
    bottom: 100px;
    flex-direction: column;
    gap: 20px;
    border: none;
    padding: 0;
}

.action-btn {
    background: none;
    border: none;
    padding: 8px 12px;
    font-size: 13px;
    font-weight: 500;
    color: #65676b;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.instagram .action-btn {
    padding: 4px;
    color: #262626;
}

.facebook .action-btn {
    flex: 1;
    justify-content: center;
    color: #65676b;
}

.linkedin .action-btn {
    flex: 1;
    justify-content: center;
    color: #00000099;
}

.tiktok .action-btn {
    flex-direction: column;
    color: white;
    gap: 4px;
    font-size: 11px;
    padding: 0;
}

.action-btn:hover:not(:disabled) {
    color: #667eea;
}

.instagram .action-btn:hover:not(:disabled) {
    opacity: 0.6;
}

.facebook .action-btn:hover:not(:disabled) {
    background: #f2f2f2;
    border-radius: 4px;
}

.linkedin .action-btn:hover:not(:disabled) {
    background: #f3f2ef;
    border-radius: 4px;
}

.tiktok .action-btn:hover:not(:disabled) {
    transform: scale(1.1);
}

.action-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.action-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.instagram .action-icon {
    width: 24px;
    height: 24px;
}

.tiktok .action-icon {
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 50%;
}

/* Buy Now button special styling */
.buy-btn {
    background: #667eea;
    color: white;
    border-radius: 6px;
    padding: 8px 16px;
    font-weight: 600;
}

.instagram .buy-btn {
    background: #0095f6;
}

.facebook .buy-btn {
    background: #1877f2;
}

.linkedin .buy-btn {
    background: #0a66c2;
}

.tiktok .buy-btn {
    background: #fe2c55;
    border-radius: 4px;
    padding: 8px 12px;
}

.buy-btn:hover:not(:disabled) {
    opacity: 0.9;
}

.results-screen {
    display: none;
    padding: 40px;
    min-height: 100vh;
    text-align: center;
}

.results-screen h2 {
    font-size: 28px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 20px;
}

.results-box {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: left;
}

.results-box h3 {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 16px;
}

.results-box p {
    font-size: 15px;
    color: #4a4a4a;
    margin-bottom: 8px;
}

@media (max-width: 768px) {
    .screen {
        padding: 30px 20px;
    }
    
    .demo-screen,
    .interface-screen {
        padding: 30px 20px;
    }
    
    .interface-grid {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>
<div class="container">
    <div class="screen" id="consentScreen">
        <h1>Social Media Behaviour Survey</h1>
        <p style="text-align:center;color:#4a4a4a;margin-bottom:30px;font-style:italic;line-height:1.8">"Congratulations! You've been invited to participate in research that contributes to the potentially groundbreaking understanding of what will go on to be known as The Attention-Conversion Paradox. I'd like to extend my sincerest gratitude to each and every participant. You're the best!" - Aman Vasandani, 2025</p>
        
        <h2 class="screen-subtitle">About This Research</h2>
        <p>This study examines how people <strong>interact with different types of fashion content</strong> on various social media platforms. You'll experience realistic social feeds and your interactions will be logged anonymously.</p>
        
        <h2 class="screen-subtitle">What You'll Do</h2>
        <ul>
            <li>Answer a few background questions (2 minutes)</li>
            <li>Choose a social media platform style</li>
            <li><strong>Browse through 15 posts and interact naturally</strong> (like, comment, share, or click 'Buy Now').</li>
        </ul>
        
        <h2 class="screen-subtitle">Privacy & Data Use</h2>
        <p>Your responses are <strong>anonymous</strong> and used only for academic research. No personal information is stored or shared.</p>
        
        <div class="consent-box">
            <input type="checkbox" id="consentCheck">
            <label for="consentCheck">I understand this is academic research and consent to participate. I understand my responses are anonymous and used only for research purposes.</label>
        </div>
        
        <button class="btn" id="startBtn" disabled>Start Survey</button>
    </div>

    <div class="demo-screen" id="demoScreen">
        <h2>About You</h2>
        <p>Help us understand shopping patterns across demographics</p>
        
        <div class="form-group">
            <label for="nameInput">Name</label>
            <input type="text" id="nameInput" placeholder="Your first name">
            <div class="anon-checkbox">
                <input type="checkbox" id="anonCheck">
                <label for="anonCheck">I'd like to be anonymous (generates random ID)</label>
            </div>
        </div>

        <div class="form-group">
            <label for="ageInput">Age Range</label>
            <select id="ageInput">
                <option value="">Select age range</option>
                <option value="18-24">18-24</option>
                <option value="25-29">25-29</option>
                <option value="30-34">30-34</option>
                <option value="35-39">35-39</option>
                <option value="40-44">40-44</option>
                <option value="45-50">45-50</option>
                <option value="50+">50+</option>
            </select>
        </div>

        <div class="form-group">
            <label for="countryInput">Country</label>
            <select id="countryInput">
                <option value="">Select country</option>
                <option value="AE">United Arab Emirates</option>
                <option value="SA">Saudi Arabia</option>
                <option value="IN">India</option>
                <option value="PK">Pakistan</option>
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
                <option value="CA">Canada</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="OTHER">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="incomeInput">Monthly Income <span id="currLabel">(USD)</span></label>
            <select id="incomeInput">
                <option value="">Select income range</option>
            </select>
        </div>

        <div class="form-group">
            <label for="genderInput">Gender</label>
            <select id="genderInput">
                <option value="">Select gender</option>
                <option value="Female">Female</option>
                <option value="Male">Male</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Prefer not to say">Prefer not to say</option>
            </select>
        </div>

        <div class="form-group">
            <label for="platformInput">Primary Social Media Platform for Fashion</label>
            <select id="platformInput">
                <option value="">Select platform</option>
                <option value="Instagram">Instagram</option>
                <option value="TikTok">TikTok</option>
                <option value="Facebook">Facebook</option>
                <option value="Pinterest">Pinterest</option>
                <option value="YouTube">YouTube</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label for="freqInput">How often do you shop for fashion items?</label>
            <select id="freqInput">
                <option value="">Select frequency</option>
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="Quarterly">Every few months</option>
                <option value="Rarely">Rarely</option>
            </select>
        </div>

        <button class="btn" id="demoBtn" disabled>Continue to Platform Selection</button>
    </div>

    <div class="interface-screen" id="interfaceScreen">
        <h2>Choose Your Experience</h2>
        <p>Select which social media interface style you'd like to experience:</p>
        
        <div class="interface-grid">
            <div class="interface-card" data-platform="facebook">
                <div class="icon">📘</div>
                <div class="name">Facebook</div>
                <div class="desc">Detailed posts</div>
            </div>
            
            <div class="interface-card" data-platform="instagram">
                <div class="icon">📷</div>
                <div class="name">Instagram</div>
                <div class="desc">Visual-first</div>
            </div>
            
            <div class="interface-card" data-platform="linkedin">
                <div class="icon">💼</div>
                <div class="name">LinkedIn</div>
                <div class="desc">Professional</div>
            </div>
            
            <div class="interface-card" data-platform="tiktok">
                <div class="icon">🎵</div>
                <div class="name">TikTok</div>
                <div class="desc">Full-screen</div>
            </div>
        </div>
        
        <button class="btn" id="interfaceBtn" disabled>Start Experience</button>
    </div>

    <div class="survey-screen" id="surveyScreen">
        <div class="survey-header">
            <div class="progress-text">Question <span id="qNum">1</span> of <span id="qTotal">15</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progFill"></div>
            </div>
        </div>
        <div class="feed" id="feed"></div>
    </div>

    <div class="results-screen" id="resultsScreen">
        <h2>Thank You!</h2>
        <div class="results-box" id="resultsBox"></div>
        <button class="btn" onclick="downloadData()">Download Results</button>
    </div>
</div>

<script>
// Global variables
var userData = {};
var selectedPlatform = '';
var answers = [];
var startTime = Date.now();

// *******************************************************************
// 1. FINAL IMAGE ARRAY (PUBLIC URLs INTEGRATED)
// *******************************************************************
var productImages = [
    'https://i.ibb.co/4nPCjLZq/Plain-T-Shirt.png',     // 01-tshirt-plain.jpg (Core Basics)
    'https://i.ibb.co/7JwnqcGf/Eco-Sneakers.png',      // 02-sneakers-eco.jpg (Stride Co.)
    'https://i.ibb.co/qYTzhX21/Luxury-Bag.png',        // 03-bag-designer.jpg (Maison Laurent)
    'https://i.ibb.co/5W16YtT8/White-Shirt.png',       // 04-shirt-white.jpg (Office Flux)
    'https://i.ibb.co/2YkJ8rkt/Hoodie.png',            // 05-hoodie-solid.jpg (Soft Spot)
    'https://i.ibb.co/hJqHZzgY/Leggings.png',          // 06-leggings-yoga.jpg (AeroFit)
    'https://i.ibb.co/mF49GBqb/Vintage-Jacket.png',    // 07-jacket-denim.jpg (The Archive)
    'https://i.ibb.co/DHhQMpNk/Watch.png',             // 08-watch-classic.jpg (Valenza Orologi)
    'https://i.ibb.co/3mKKvcyd/Summer-Dress.png',      // 09-dress-floral.jpg (Sundays)
    'https://i.ibb.co/0RjKxKf9/Sweatshirt-Set.png',    // 10-set-lounge.jpg (Lounge Drop)
    'https://i.ibb.co/274dVCyx/Blazer.png',            // 11-blazer-wool.jpg (Struktura Atelier)
    'https://i.ibb.co/Gf4xLxtJ/Street-Sneakers.png',   // 12-sneakers-street.jpg (Rush Runner)
    'https://i.ibb.co/rRt77DZK/Wide-Leg-Trousers.png', // 13-trousers-wide.jpg (Vogue Élan)
    'https://i.ibb.co/00YQVty/Sunglasses.png',         // 14-sunglasses-polar.jpg (Optic Haze)
    'https://i.ibb.co/HM15qm8/Trench-Coat.png'         // 15-trench-coat.jpg (Porte-Vent)
];
// *******************************************************************

// Survey questions (Now acting as captions/content) with final tiered brand names
var questions = [
    {text: 'When you discover new brands on social media, which platforms make you feel most confident about their quality?', caption: 'The perfect essential tee: soft-washed cotton, ideal drape, and crafted for longevity. Build your wardrobe foundation with quality that lasts. Always in stock.', image: 'Cotton T-Shirt', price: 45, brand: 'Core Basics'},
    {text: 'Think about your last purchase discovered through social media. How many times did you see it before buying?', caption: 'Step into sustainable style with the new Stride Co. \'Eco-Stride\'. Featuring recycled materials and zero-waste construction. Lightweight comfort meets green design.', image: 'Eco Sneakers', price: 89, brand: 'Stride Co.'},
    {text: 'What is the biggest gap between what catches your attention online and what you actually purchase?', caption: 'Maison Laurent: The \'Voyager\' tote. Italian leather, minimalist design, maximum utility. The only bag you need to transition seamlessly from the office to the weekend.', image: 'Designer Handbag', price: 156, brand: 'Maison Laurent'},
    {text: 'How do you balance quality vs quantity when shopping online?', caption: 'Office Flux: Our crisp white shirt is redefined with a wrinkle-resistant stretch fabric. Look sharp, feel comfortable. A workwear essential that truly performs.', image: 'White Shirt', price: 67, brand: 'Office Flux'},
    {text: 'Do likes or comments on a fashion post influence your perception of whether it is worth buying?', caption: 'Cozy up in our bestselling Soft Spot French Terry Hoodie. Oversized fit, premium heavyweight fabric, and the perfect shade for everyday style. Comfort, elevated.', image: 'Hoodie', price: 125, brand: 'Soft Spot'},
    {text: 'When you see influencers or friends wearing something, does that make you more likely to buy it compared to ads?', caption: 'Engineered for movement: AeroFit high-waisted performance leggings offer compression and breathability. Perfect for your toughest workout or your most relaxed day.', image: 'Leggings', price: 78, brand: 'AeroFit'},
    {text: 'Do you research products on multiple platforms before buying, or do you make impulse purchases?', caption: 'The ultimate throwback: a genuine 90s-inspired denim jacket from The Archive. Each piece is hand-distressed for a unique, lived-in feel. Limited quantity drop.', image: 'Vintage Jacket', price: 95, brand: 'The Archive'},
    {text: 'When buying accessories, do you prioritize brands you have seen multiple times on social media?', caption: 'Valenza Orologi: Precision engineering meets classic design. The \'Chrono-X\' timepiece features a sapphire crystal and reliable quartz movement. A timeless piece for the modern professional.', image: 'Watch', price: 189, brand: 'Valenza Orologi'},
    {text: 'Are you more likely to buy trending seasonal items or classic pieces that appear less frequently?', caption: 'Flowy, light, and vibrant. Our linen-blend summer dress from Sundays is perfect for destination weddings or effortless daily wear. Get vacation ready.', image: 'Summer Dress', price: 72, brand: 'Sundays'},
    {text: 'Do promotional posts with discount codes make you more likely to buy immediately?', caption: 'The ultimate lounge wear set from Lounge Drop: super-soft organic cotton sweatshirt and joggers. Matching style, unmatched comfort. Your new weekend uniform.', image: 'Sweatshirt Set', price: 85, brand: 'Lounge Drop'},
    {text: 'When you see the same product across multiple platforms, does that increase your trust in it?', caption: 'Struktura Atelier: The unstructured wool-blend blazer. Tailored for comfort, styled for versatility. The modern interpretation of professional attire.', image: 'Blazer', price: 145, brand: 'Struktura Atelier'},
    {text: 'Which type of content makes you most likely to actually purchase?', caption: 'Built for speed, styled for the street. Our new Rush Runner sneakers offer responsive cushioning and a striking silhouette. Available in three colorways.', image: 'Sneakers', price: 110, brand: 'Rush Runner'},
    {text: 'Do you prefer posts that focus on the garment\'s fit/cut or its material/sustainability?', caption: 'Vogue Élan: The ultimate versatile pant: wide-leg trousers in a breathable linen blend. Effortlessly polished for the office or a chic weekend.', image: 'Wide-Leg Trousers', price: 99, brand: 'Vogue Élan'},
    {text: 'How important are video reviews of an accessory (like a watch or glasses) compared to high-quality photos?', caption: 'Classic geometry, modern feel. Optic Haze polarized sunglasses offer 100% UV protection and a universally flattering fit. Essential summer clarity.', image: 'Polarized Sunglasses', price: 65, brand: 'Optic Haze'},
    {text: 'Which style of ad is most convincing for a high-value purchase like a coat: static studio shot or a dynamic outdoor scene?', caption: 'Porte-Vent: The iconic trench, redefined. Water-resistant, perfectly structured, and ready for transitional weather. An investment piece that lasts decades.', image: 'Trench Coat', price: 210, brand: 'Porte-Vent'}
];

// *******************************************************************
// ICON AND UTILITY FUNCTIONS (UNMODIFIED)
// *******************************************************************

var icons = { 
    like: {
        instagram: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>',
        facebook: '<svg fill="currentColor" viewBox="0 0 48 48" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4.5H8.5V12h2.5V9.5h2V12h2.5v.5H13v4.5h-2z"/></svg>',
        linkedin: '<svg fill="currentColor" viewBox="0 0 48 48" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14h2v-6h-2v6zm-1-7h4v-2h-4v2z"/></svg>',
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M34.6 6.1c-1.6 0-2.9 1.3-2.9 2.9v20.3c0 6.4-5.2 11.6-11.6 11.6s-11.6-5.2-11.6-11.6 5.2-11.6 11.6-11.6c.3 0 .7 0 1 .1v-5.2c-.3 0-.7-.1-1-.1-9.2 0-16.7 7.5-16.7 16.7S10.9 46 20.1 46s16.7-7.5 16.7-16.7V15.8c2.6 1.9 5.8 3 9.2 3V13.6c-5.8 0-10.5-4.7-10.5-10.5h-5.1z"/></svg>'
    },
    comment: {
        instagram: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>',
        facebook: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2zm0-10h2v6h-2z"/></svg>',
        linkedin: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v2h-2zm0-10h2v6h-2z"/></svg>',
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm-2-6h4v4h-4zm0-16h4v12h-4z"/></svg>'
    },
    share: {
        instagram: '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>',
        facebook: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>',
        linkedin: '<svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>',
        tiktok: '<svg fill="currentColor" viewBox="0 0 48 48" width="32" height="32"><path d="M36 20v-4c-3.31 0-6-2.69-6-6h-4v20c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6v-4c-5.52 0-10 4.48-10 10s4.48 10 10 10 10-4.48 10-10V16c2.48 1.53 5.39 2.44 8.5 2.44z"/></svg>'
    }
};

// Consent Check logic
document.getElementById('consentCheck').addEventListener('change', function() {
    document.getElementById('startBtn').disabled = !this.checked;
});
document.getElementById('startBtn').addEventListener('click', function() {
    document.getElementById('consentScreen').style.display = 'none';
    document.getElementById('demoScreen').style.display = 'block';
});

// Form validation
var demoFields = ['nameInput', 'ageInput', 'countryInput', 'incomeInput', 'genderInput', 'platformInput', 'freqInput'];

demoFields.forEach(function(id) {
    var el = document.getElementById(id);
    el.addEventListener('change', validateDemo);
    el.addEventListener('input', validateDemo);
});

function validateDemo() {
    var filled = demoFields.every(function(id) {
        return document.getElementById(id).value.trim() !== '';
    });
    document.getElementById('demoBtn').disabled = !filled;
}

// Anonymous checkbox - FIX: Removed hyphen from ID generation
document.getElementById('anonCheck').addEventListener('change', function() {
    var nameInput = document.getElementById('nameInput');
    if (this.checked) {
        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        var id = 'ANON';
        for (var i = 0; i < 8; i++) {
            id += chars[Math.floor(Math.random() * chars.length)];
        }
        nameInput.value = id;
        nameInput.readOnly = true;
    } else {
        nameInput.value = '';
        nameInput.readOnly = false;
    }
    validateDemo();
});

// Currency conversion and income options
document.getElementById('countryInput').addEventListener('change', function() {
    var country = this.value;
    var label = document.getElementById('currLabel');
    var select = document.getElementById('incomeInput');
    
    select.innerHTML = '<option value="">Select income range</option>';
    
    var currData = {
        'AE': {curr: 'AED', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'SA': {curr: 'SAR', ranges: ['Under 3,000', '3,000-5,000', '5,000-8,000', '8,000-12,000', '12,000-18,000', 'Over 18,000']},
        'IN': {curr: 'INR', ranges: ['Under 25,000', '25,000-50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', 'Over 150,000']},
        'PK': {curr: 'PKR', ranges: ['Under 50,000', '50,000-75,000', '75,000-100,000', '100,000-150,000', '150,000-200,000', 'Over 200,000']},
        'UK': {curr: 'GBP', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'CA': {curr: 'CAD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'AU': {curr: 'AUD', ranges: ['Under 2,500', '2,500-4,000', '4,000-5,500', '5,500-7,000', '7,000-9,000', 'Over 9,000']},
        'DE': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']},
        'FR': {curr: 'EUR', ranges: ['Under 2,000', '2,000-3,000', '3,000-4,000', '4,000-5,000', '5,000-7,000', 'Over 7,000']}
    };
    
    var info = currData[country] || {curr: 'USD', ranges: ['Under 2,000', '2,000-3,500', '3,500-5,000', '5,000-7,000', '7,000-10,000', 'Over 10,000']};
    label.textContent = '(' + info.curr + ')';
    
    info.ranges.forEach(function(r) {
        var opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        select.appendChild(opt);
    });
});

document.getElementById('demoBtn').addEventListener('click', function() {
    userData = {
        name: document.getElementById('nameInput').value,
        age: document.getElementById('ageInput').value,
        country: document.getElementById('countryInput').value,
        income: document.getElementById('incomeInput').value,
        gender: document.getElementById('genderInput').value,
        platform: document.getElementById('platformInput').value,
        frequency: document.getElementById('freqInput').value,
        anonymous: document.getElementById('anonCheck').checked
    };
    
    document.getElementById('demoScreen').style.display = 'none';
    document.getElementById('interfaceScreen').style.display = 'block';
});

// Interface selection
document.querySelectorAll('.interface-card').forEach(function(card) {
    card.addEventListener('click', function() {
        document.querySelectorAll('.interface-card').forEach(function(c) {
            c.classList.remove('selected');
        });
        this.classList.add('selected');
        selectedPlatform = this.dataset.platform;
        document.getElementById('interfaceBtn').disabled = false;
    });
});

document.getElementById('interfaceBtn').addEventListener('click', function() {
    document.getElementById('interfaceScreen').style.display = 'none';
    document.getElementById('surveyScreen').style.display = 'flex';
    initSurvey();
});

// Convert price based on country
function getPriceForCountry(usd, country) {
    var rates = {
        'AE': {r: 3.67, s: 'AED', after: true}, 'SA': {r: 3.75, s: 'SAR', after: true},
        'IN': {r: 83, s: '₹', after: false}, 'PK': {r: 280, s: 'PKR', after: true},
        'US': {r: 1, s: '$', after: false}, 'UK': {r: 0.79, s: '£', after: false},
        'CA': {r: 1.35, s: 'CAD $', after: false}, 'AU': {r: 1.50, s: 'AUD $', after: false},
        'DE': {r: 0.92, s: '€', after: false}, 'FR': {r: 0.92, s: '€', after: false}
    };
    var info = rates[country] || rates['US'];
    var amt = Math.round(usd * info.r);
    return info.after ? (amt + ' ' + info.s) : (info.s + amt);
}

// Answer question
function answer(idx, choice) {
    var now = Date.now();
    var post = document.querySelector('[data-index="' + idx + '"]');

    // Store answer only if not already answered
    if (!answers.some(a => a.question_index === idx)) {
        answers.push({
            question_index: idx,
            platform: selectedPlatform,
            action: choice,
            time_ms: now - startTime
        });
        
        // Disable all actions for this post
        var btns = post.querySelectorAll('.action-btn');
        btns.forEach(function(b) { b.disabled = true; });

        // Highlight the selected action
        var chosenBtnContainer = post.querySelector('.action-btn[onclick*="' + choice + '"]');
        if (chosenBtnContainer) {
            chosenBtnContainer.style.opacity = '1.0';
            chosenBtnContainer.style.color = selectedPlatform === 'tiktok' ? '#fe2c55' : '#667eea';
            chosenBtnContainer.style.fontWeight = 'bold';
        }

        updateProgress();

        if (answers.length === questions.length) {
            setTimeout(showResults, 1000);
        } else {
            // Scroll to the next un-answered post
            setTimeout(function() {
                var nextUnanswered = document.querySelector('.post:not(.answered)');
                if (nextUnanswered) {
                    nextUnanswered.scrollIntoView({behavior: 'smooth', block: 'start'});
                }
            }, 500);
        }
    }
    // Mark post as answered to prevent re-answering
    post.classList.add('answered');
}

// Update progress
function updateProgress() {
    var count = answers.length;
    var total = questions.length;
    var pct = (count / total) * 100;
    
    // Update question number text
    document.getElementById('qNum').textContent = count + 1 > total ? total : count + 1;
    document.getElementById('progFill').style.width = pct + '%';
}

// Show results
function showResults() {
    document.getElementById('surveyScreen').style.display = 'none';
    document.getElementById('resultsScreen').style.display = 'block';
    
    var totalTime = Math.floor((Date.now() - startTime) / 1000);
    var totalResponseTime = answers.reduce((sum, a) => sum + a.time_ms, 0);
    var avgTime = totalResponseTime / answers.length / 1000;
    
    document.getElementById('resultsBox').innerHTML = '<h3>Survey Complete!</h3><p><strong>Platform:</strong> ' + selectedPlatform.charAt(0).toUpperCase() + selectedPlatform.slice(1) + '</p><p><strong>Questions:</strong> ' + questions.length + '</p><p><strong>Total Time:</strong> ' + Math.floor(totalTime / 60) + ':' + String(totalTime % 60).padStart(2, '0') + '</p><p><strong>Average Response:</strong> ' + avgTime.toFixed(1) + 's</p><p style="margin-top:16px;font-style:italic;">Thank you for contributing to fashion retail research!</p>';
}

// Download data
function downloadData() {
    var data = {
        demographics: userData,
        platform: selectedPlatform,
        answers: answers,
        totalTime_ms: Date.now() - startTime,
        timestamp: new Date().toISOString()
    };
    
    // REPLACE 'YOUR_GOOGLE_SCRIPT_URL_HERE' WITH YOUR ACTUAL GOOGLE APPS SCRIPT URL
    fetch('YOUR_GOOGLE_SCRIPT_URL_HERE', {
        method: 'POST',
        mode: 'no-cors',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    }).catch(function(err) {
        console.log('Upload failed (This is expected if no Google Script URL is provided):', err);
    });
    
    // Also download locally as backup
    var blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'survey-' + userData.name.substring(0,4) + '-' + selectedPlatform + '-' + Date.now() + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}


// Initialize survey
function initSurvey() {
    var feed = document.getElementById('feed');
    feed.innerHTML = '';
    feed.className = 'feed ' + selectedPlatform;
    
    document.getElementById('qTotal').textContent = questions.length;
    
    questions.forEach(function(q, idx) {
        var price = getPriceForCountry(q.price, userData.country);
        var imagePath = productImages[idx]; 
        var brandName = q.brand; 
        
        var post = document.createElement('div');
        post.className = 'post';
        post.dataset.index = idx;
        
        // This button calls the answer function with 'buy', logging the purchase intent.
        var buyBtnClass = (selectedPlatform === 'facebook' || selectedPlatform === 'linkedin') ? 'btn buy-btn' : 'buy-btn';
        var buyBtnHTML = '<button class="' + buyBtnClass + '" onclick="answer(' + idx + ', \'buy\')">Shop Now</button>'; 

        var actionsHTML = '';
        var headerHTML = '';

        // Shared Image Block: Uses the public URL as a background image for proper scaling
        var imageHTML = '<div class="post-image" style="background-image: url(\'' + imagePath + '\');"></div>';

        // Content Block
        var contentHTML = '<div class="post-content">' +
            // Branding: Brand Name
            '<div class="post-text"><strong>' + brandName + '</strong> ' + q.caption + '</div>' + 
            '<div class="post-price">' + price + '</div>' +
            '</div>';

        // Platform-Specific Assembly
        if (selectedPlatform === 'tiktok') {
            // TikTok assembly is unique with overlay actions and content
            // Branding: @BrandName (lowercase, common for TikTok)
            var tiktokHandle = '@' + brandName.toLowerCase().replace(/ /g, '');
            headerHTML = '<div class="post-header"><div class="post-avatar">B</div><div class="post-info"><div class="brand">' + tiktokHandle + '</div><div class="time">Sponsored</div></div></div>';
            
            // TikTok actions are vertical and float on the right
            actionsHTML = '<div class="post-actions">' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'like\')"><div class="action-icon">' + icons.like.tiktok + '</div><span>Like</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'comment\')"><div class="action-icon">' + icons.comment.tiktok + '</div><span>Comment</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'share\')"><div class="action-icon">' + icons.share.tiktok + '</div><span>Share</span></button>' +
                '</div>' +
                // Buy button positioned specifically on TikTok
                '<div style="position: absolute; bottom: 80px; left: 16px; z-index: 10;">' + buyBtnHTML + '</div>'; 

            // TikTok has overlay content
            post.innerHTML = imageHTML + 
                '<div class="post-content" style="position:absolute; bottom:0; width:100%; color:white; padding-bottom:100px; padding-top: 150px; background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%); z-index: 5;">' +
                // Branding: @BrandName and Caption
                '<div class="post-text" style="color:white; font-size: 15px;">' + tiktokHandle + ' ' + q.caption + '</div>' +
                '<div class="post-promo" style="color:yellow; font-size: 14px;">' + price + ' • Shop Now</div>' +
                '</div>' + headerHTML + actionsHTML;
            
        } else {
            // Facebook, Instagram, LinkedIn assembly
            var sponsoredTag = (selectedPlatform === 'facebook' || selectedPlatform === 'linkedin') ? ' <span style="font-weight: normal; color: #606770;">· Sponsored</span>' : '';
            // Branding: Full Brand Name
            headerHTML = '<div class="post-header"><div class="post-avatar">B</div><div class="post-info"><div class="brand">' + brandName + sponsoredTag + '</div><div class="time">2h ago</div></div></div>';

            actionsHTML = '<div class="post-actions">' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'like\')"><div class="action-icon">' + icons.like[selectedPlatform] + '</div><span>Like</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'comment\')"><div class="action-icon">' + icons.comment[selectedPlatform] + '</div><span>Comment</span></button>' +
                '<button class="action-btn" onclick="answer(' + idx + ', \'share\')"><div class="action-icon">' + icons.share[selectedPlatform] + '</div><span>Share</span></button>' +
                '<div class="action-btn buy-btn-container">' + buyBtnHTML + '</div>' +
                '</div>';
            
            post.innerHTML = headerHTML + imageHTML + contentHTML + actionsHTML;
        }

        feed.appendChild(post);
    });
}
</script>
</body>
</html>
