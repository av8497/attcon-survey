<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Behavior Study</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .container {
            max-width: 450px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        /* Disclaimer & Consent */
        .disclaimer-form {
            padding: 30px 25px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .disclaimer-title {
            font-size: 26px;
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }

        .disclaimer-subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 16px;
            line-height: 1.4;
        }

        .disclaimer-content {
            text-align: left;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-size: 14px;
            line-height: 1.5;
            color: #555;
        }

        .disclaimer-content h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .disclaimer-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .consent-checkbox {
            text-align: left;
            margin-bottom: 25px;
        }

        .consent-checkbox input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .consent-checkbox label {
            color: #555;
            font-size: 14px;
            line-height: 1.4;
            cursor: pointer;
        }

        /* Demographic Form */
        .demographic-form {
            padding: 30px 25px;
            display: none;
            flex: 1;
            overflow-y: auto;
        }

        .form-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
            font-weight: 600;
        }

        .form-subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
            text-align: center;
            line-height: 1.4;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .currency-income-group {
            display: flex;
            gap: 15px;
        }

        .currency-income-group .form-group {
            flex: 1;
        }

        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .radio-option:hover {
            border-color: #667eea;
        }

        .radio-option.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .radio-option input[type="radio"] {
            margin-right: 8px;
        }

        .continue-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
            font-weight: 600;
        }

        .continue-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .continue-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Interface Selection */
        .interface-selection {
            padding: 30px 25px;
            display: none;
            flex: 1;
            text-align: center;
        }

        .selection-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
        }

        .selection-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.4;
        }

        .interface-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .interface-option {
            background: white;
            border: 2px solid #e0e6ed;
            border-radius: 15px;
            padding: 20px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .interface-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .interface-option.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        .option-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .option-desc {
            font-size: 12px;
            color: #666;
        }

        /* Instruction Modal */
        .instruction-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .instruction-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .instruction-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .instruction-text {
            color: #666;
            line-height: 1.5;
            margin-bottom: 25px;
            font-size: 16px;
        }

        .instruction-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .instruction-btn:hover {
            transform: translateY(-2px);
        }

        /* Warning Modal */
        .warning-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .warning-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .warning-title {
            font-size: 22px;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 15px;
        }

        .warning-text {
            color: #666;
            line-height: 1.5;
            margin-bottom: 25px;
            font-size: 15px;
        }

        .warning-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .warning-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            border: none;
        }

        .warning-btn:hover {
            transform: translateY(-1px);
        }

        .continue-warning-btn {
            background: #e74c3c;
            color: white;
        }

        .go-back-btn {
            background: #f0f2f5;
            color: #666;
        }

        /* Survey Header */
        .survey-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e1e8ed;
            display: none;
        }

        .progress-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .survey-title {
            font-size: 18px;
            font-weight: 600;
            color: #1c1e21;
        }

        .progress-text {
            font-size: 14px;
            color: #657786;
            font-weight: 500;
        }

        .progress-bar {
            height: 4px;
            background: #e1e8ed;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Feed Container */
        .feed-container {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            background: #f0f2f5;
            display: none;
        }

        .feed-container::-webkit-scrollbar {
            display: none;
        }

        /* Post Styles */
        .post {
            background: white;
            margin: 8px 16px 16px 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.6s ease forwards;
        }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .post-header {
            padding: 16px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f2f5;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
        }

        .post-info h3 {
            font-size: 15px;
            font-weight: 600;
            color: #1c1e21;
            margin-bottom: 2px;
        }

        .post-info p {
            font-size: 13px;
            color: #65676b;
        }

        .post-content {
            padding: 0;
        }

        .post-text {
            padding: 16px;
            font-size: 16px;
            line-height: 1.5;
            color: #1c1e21;
        }

        .post-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            position: relative;
        }

        .price-tag {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 14px;
        }

        .post-actions {
            padding: 16px;
            border-top: 1px solid #f0f2f5;
            display: flex;
            justify-content: space-around;
            gap: 8px;
        }

        .action-btn {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #e4e6ea;
            border-radius: 20px;
            background: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .like-btn {
            border-color: #e1306c;
            color: #e1306c;
        }

        .like-btn:hover:not(:disabled) {
            background: #e1306c;
            color: white;
        }

        .share-btn {
            border-color: #1877f2;
            color: #1877f2;
        }

        .share-btn:hover:not(:disabled) {
            background: #1877f2;
            color: white;
        }

        .buy-btn {
            border-color: #00ba7c;
            color: #00ba7c;
        }

        .buy-btn:hover:not(:disabled) {
            background: #00ba7c;
            color: white;
        }

        .selected {
            transform: scale(0.95) !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }

        /* Results Screen */
        .results-screen {
            display: none;
            padding: 40px 25px;
            text-align: center;
            flex: 1;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .results-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .results-content {
            color: #666;
            line-height: 1.5;
            margin-bottom: 30px;
        }

        .download-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .download-btn:hover {
            transform: translateY(-2px);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 5px;
                min-height: 95vh;
            }

            .interface-options {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .currency-income-group {
                flex-direction: column;
                gap: 12px;
            }

            .radio-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Disclaimer & Consent -->
        <div class="disclaimer-form" id="disclaimerForm">
            <h1 class="disclaimer-title">Fashion Shopping Research</h1>
            <p class="disclaimer-subtitle">Understanding social media shopping behavior across different platforms</p>
            
            <div class="disclaimer-content">
                <h3>About This Research</h3>
                <p>This study examines how people interact with fashion content on different social media platforms. You'll experience realistic social feeds and can interact naturally.</p>
                
                <h3>What You'll Do</h3>
                <ul>
                    <li>Answer a few background questions (2 minutes)</li>
                    <li>Choose a social media platform style</li>
                    <li>Browse through posts and interact naturally</li>
                </ul>
                
                <h3>Privacy & Data Use</h3>
                <p>Your responses are anonymous and used only for academic research. No personal information is stored or shared.</p>
            </div>
            
            <div class="consent-checkbox">
                <input type="checkbox" id="consentCheck" onchange="toggleContinueButton()">
                <label for="consentCheck">
                    I understand this is academic research and consent to participate. I understand my responses are anonymous and used only for research purposes.
                </label>
            </div>
            
            <button class="continue-btn" id="continueBtn" onclick="showDemographics()" disabled>
                Start Survey
            </button>
        </div>

        <!-- Demographics Form -->
        <div class="demographic-form" id="demographicForm">
            <h2 class="form-title">Tell us about yourself</h2>
            <p class="form-subtitle">This helps us understand shopping behavior across different demographics and regions</p>
            
            <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="participantName" placeholder="Enter your first name" required>
            </div>

            <div class="form-group">
                <label>Age Range</label>
                <select id="ageRange" onchange="validateDemographics()" required>
                    <option value="">Select your age range</option>
                    <option value="18-24">18-24 years</option>
                    <option value="25-29">25-29 years</option>
                    <option value="30-34">30-34 years</option>
                    <option value="35-39">35-39 years</option>
                    <option value="40-44">40-44 years</option>
                    <option value="45-50">45-50 years</option>
                    <option value="50+">50+ years</option>
                </select>
            </div>

            <div class="form-group">
                <label>Country</label>
                <select id="country" onchange="updateCurrencyAndIncome()" required>
                    <option value="">Select your country</option>
                    <option value="AE">United Arab Emirates</option>
                    <option value="SA">Saudi Arabia</option>
                    <option value="US">United States</option>
                    <option value="UK">United Kingdom</option>
                    <option value="CA">Canada</option>
                    <option value="AU">Australia</option>
                    <option value="IN">India</option>
                    <option value="PK">Pakistan</option>
                    <option value="BD">Bangladesh</option>
                    <option value="PH">Philippines</option>
                    <option value="EG">Egypt</option>
                    <option value="NG">Nigeria</option>
                    <option value="KE">Kenya</option>
                    <option value="ZA">South Africa</option>
                    <option value="DE">Germany</option>
                    <option value="FR">France</option>
                    <option value="IT">Italy</option>
                    <option value="ES">Spain</option>
                    <option value="NL">Netherlands</option>
                    <option value="SG">Singapore</option>
                    <option value="MY">Malaysia</option>
                    <option value="TH">Thailand</option>
                    <option value="ID">Indonesia</option>
                    <option value="JP">Japan</option>
                    <option value="KR">South Korea</option>
                    <option value="CN">China</option>
                    <option value="BR">Brazil</option>
                    <option value="MX">Mexico</option>
                    <option value="OTHER">Other</option>
                </select>
            </div>

            <div class="currency-income-group">
                <div class="form-group">
                    <label>Currency</label>
                    <input type="text" id="currency" readonly style="background-color: #f8f9fa;">
                </div>
                
                <div class="form-group">
                    <label>Monthly Income</label>
                    <select id="income" onchange="validateDemographics()" required>
                        <option value="">Select income range</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Gender</label>
                <div class="radio-group">
                    <div class="radio-option" onclick="selectGender('female')">
                        <input type="radio" name="gender" value="female" id="female">
                        <label for="female">Female</label>
                    </div>
                    <div class="radio-option" onclick="selectGender('male')">
                        <input type="radio" name="gender" value="male" id="male">
                        <label for="male">Male</label>
                    </div>
                    <div class="radio-option" onclick="selectGender('non-binary')">
                        <input type="radio" name="gender" value="non-binary" id="non-binary">
                        <label for="non-binary">Non-binary</label>
                    </div>
                    <div class="radio-option" onclick="selectGender('prefer-not-to-say')">
                        <input type="radio" name="gender" value="prefer-not-to-say" id="prefer-not-to-say">
                        <label for="prefer-not-to-say">Prefer not to say</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Primary Platform for Fashion Discovery</label>
                <select id="primaryPlatform" onchange="validateDemographics()" required>
                    <option value="">Select primary platform</option>
                    <option value="Instagram">Instagram</option>
                    <option value="TikTok">TikTok</option>
                    <option value="Facebook">Facebook</option>
                    <option value="LinkedIn">LinkedIn</option>
                    <option value="YouTube">YouTube</option>
                    <option value="Pinterest">Pinterest</option>
                    <option value="Twitter/X">Twitter/X</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Online Shopping Frequency</label>
                <select id="shoppingFrequency" onchange="validateDemographics()" required>
                    <option value="">Select frequency</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Every few months</option>
                    <option value="annually">Few times a year</option>
                    <option value="rarely">Rarely</option>
                </select>
            </div>
            
            <button class="continue-btn" id="demographicsContinueBtn" onclick="showInterfaceSelection()" disabled>
                Continue to Platform Selection
            </button>
        </div>

        <!-- Interface Selection -->
        <div class="interface-selection" id="interfaceSelection">
            <h2 class="selection-title">Choose Your Platform Experience</h2>
            <p class="selection-subtitle">Select the social media style that feels most natural to you</p>
            
            <div class="interface-options">
                <div class="interface-option" data-interface="facebook" onclick="selectInterface('facebook')">
                    <div class="option-icon">📘</div>
                    <div class="option-name">Facebook</div>
                    <div class="option-desc">Detailed posts with discussions</div>
                </div>
                <div class="interface-option" data-interface="instagram" onclick="selectInterface('instagram')">
                    <div class="option-icon">📸</div>
                    <div class="option-name">Instagram</div>
                    <div class="option-desc">Visual stories and posts</div>
                </div>
                <div class="interface-option" data-interface="linkedin" onclick="selectInterface('linkedin')">
                    <div class="option-icon">💼</div>
                    <div class="option-name">LinkedIn</div>
                    <div class="option-desc">Professional networking</div>
                </div>
                <div class="interface-option" data-interface="tiktok" onclick="selectInterface('tiktok')">
                    <div class="option-icon">🎵</div>
                    <div class="option-name">TikTok</div>
                    <div class="option-desc">Short-form videos</div>
                </div>
            </div>
            
            <button class="continue-btn" id="startExperienceBtn" onclick="startSurveyExperience()" disabled>
                Start Survey
            </button>
        </div>

        <!-- Instruction Modal -->
        <div class="instruction-modal" id="instructionModal">
            <div class="instruction-content">
                <h2 class="instruction-title">📱 How to Use This Feed</h2>
                <div class="instruction-text">
                    <p><strong>Scroll naturally</strong> through the feed just like you normally would on <span id="platformName">social media</span>.</p>
                    <br>
                    <p>You can react to posts by:</p>
                    <p>❤️ <strong>Like</strong> • 📤 <strong>Share</strong> • 🛒 <strong>Buy Now</strong></p>
                    <br>
                    <p>Or simply <strong>scroll past</strong> if nothing interests you.</p>
                    <br>
                    <p><em>Take your time and interact naturally!</em></p>
                </div>
                <button class="instruction-btn" onclick="startFeedExperience()">Got it! Start</button>
            </div>
        </div>

        <!-- Warning Modal -->
        <div class="warning-modal" id="warningModal">
            <div class="warning-content">
                <h2 class="warning-title">⚠️ No Engagement Detected</h2>
                <div class="warning-text">
                    <p>We noticed you haven't interacted with any posts yet.</p>
                    <br>
                    <p>Are you sure you want to submit a blank survey? Your natural reactions help us understand social media behavior better.</p>
                </div>
                <div class="warning-actions">
                    <button class="warning-btn go-back-btn" onclick="goBackToFeed()">Go Back & Engage</button>
                    <button class="warning-btn continue-warning-btn" onclick="submitBlankSurvey()">Submit Blank Survey</button>
                </div>
            </div>
        </div>

        <!-- Survey Header -->
        <div class="survey-header" id="surveyHeader">
            <div class="progress-container">
                <div class="survey-title" id="surveyTitle">Social Feed</div>
                <div class="progress-text"><span id="currentPost">1</span> / <span id="totalPosts">15</span></div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Feed Container -->
        <div class="feed-container" id="feedContainer">
            <!-- Posts will be generated here -->
        </div>

        <!-- Results Screen -->
        <div class="results-screen" id="resultsScreen">
            <h2 class="results-title">🎉 Thank You!</h2>
            <div class="results-content">
                <p>Your responses have been collected successfully. This data will help us understand social media shopping behavior across different platforms.</p>
            </div>
            <button class="download-btn" onclick="downloadResults()">Download Your Data</button>
        </div>
    </div>

    <script>
        // Survey state
        let selectedInterface = null;
        let currentPost = 0;
        let responses = [];
        let demographicData = {};
        let startTime = Date.now();
        let surveyStartTime = null;
        let questionViewTimes = {};
        let questionFirstView = {};
        let hasEngaged = false;
        let scrollStartTime = null;
        let isScrolling = false;

        // Currency conversion data
        const currencyData = {
            'AE': { currency: 'AED', symbol: 'AED' },
            'SA': { currency: 'SAR', symbol: 'SAR' },
            'US': { currency: 'USD', symbol: ' },
            'UK': { currency: 'GBP', symbol: '£' },
            'CA': { currency: 'CAD', symbol: 'C },
            'AU': { currency: 'AUD', symbol: 'A },
            'IN': { currency: 'INR', symbol: '₹' },
            'PK': { currency: 'PKR', symbol: 'Rs' },
            'BD': { currency: 'BDT', symbol: '৳' },
            'PH': { currency: 'PHP', symbol: '₱' },
            'EG': { currency: 'EGP', symbol: 'E£' },
            'NG': { currency: 'NGN', symbol: '₦' },
            'KE': { currency: 'KES', symbol: 'KSh' },
            'ZA': { currency: 'ZAR', symbol: 'R' },
            'DE': { currency: 'EUR', symbol: '€' },
            'FR': { currency: 'EUR', symbol: '€' },
            'IT': { currency: 'EUR', symbol: '€' },
            'ES': { currency: 'EUR', symbol: '€' },
            'NL': { currency: 'EUR', symbol: '€' },
            'SG': { currency: 'SGD', symbol: 'S },
            'MY': { currency: 'MYR', symbol: 'RM' },
            'TH': { currency: 'THB', symbol: '฿' },
            'ID': { currency: 'IDR', symbol: 'Rp' },
            'JP': { currency: 'JPY', symbol: '¥' },
            'KR': { currency: 'KRW', symbol: '₩' },
            'CN': { currency: 'CNY', symbol: '¥' },
            'BR': { currency: 'BRL', symbol: 'R },
            'MX': { currency: 'MXN', symbol: ' },
            'OTHER': { currency: 'USD', symbol: ' }
        };

        // Income ranges by currency
        const incomeRanges = {
            'AED': [
                { value: 'under-3000', label: 'Under AED 3,000' },
                { value: '3000-5000', label: 'AED 3,000 - 5,000' },
                { value: '5000-8000', label: 'AED 5,000 - 8,000' },
                { value: '8000-12000', label: 'AED 8,000 - 12,000' },
                { value: '12000-18000', label: 'AED 12,000 - 18,000' },
                { value: '18000-25000', label: 'AED 18,000 - 25,000' },
                { value: 'over-25000', label: 'Over AED 25,000' }
            ],
            'USD': [
                { value: 'under-800', label: 'Under $800' },
                { value: '800-1300', label: '$800 - 1,300' },
                { value: '1300-2200', label: '$1,300 - 2,200' },
                { value: '2200-3300', label: '$2,200 - 3,300' },
                { value: '3300-5000', label: '$3,300 - 5,000' },
                { value: '5000-7000', label: '$5,000 - 7,000' },
                { value: 'over-7000', label: 'Over $7,000' }
            ],
            'GBP': [
                { value: 'under-600', label: 'Under £600' },
                { value: '600-1000', label: '£600 - 1,000' },
                { value: '1000-1700', label: '£1,000 - 1,700' },
                { value: '1700-2500', label: '£1,700 - 2,500' },
                { value: '2500-3800', label: '£2,500 - 3,800' },
                { value: '3800-5500', label: '£3,800 - 5,500' },
                { value: 'over-5500', label: 'Over £5,500' }
            ],
            'INR': [
                { value: 'under-20000', label: 'Under ₹20,000' },
                { value: '20000-35000', label: '₹20,000 - 35,000' },
                { value: '35000-50000', label: '₹35,000 - 50,000' },
                { value: '50000-75000', label: '₹50,000 - 75,000' },
                { value: '75000-100000', label: '₹75,000 - 1,00,000' },
                { value: '100000-150000', label: '₹1,00,000 - 1,50,000' },
                { value: 'over-150000', label: 'Over ₹1,50,000' }
            ],
            'EUR': [
                { value: 'under-700', label: 'Under €700' },
                { value: '700-1200', label: '€700 - 1,200' },
                { value: '1200-2000', label: '€1,200 - 2,000' },
                { value: '2000-3000', label: '€2,000 - 3,000' },
                { value: '3000-4500', label: '€3,000 - 4,500' },
                { value: '4500-6500', label: '€4,500 - 6,500' },
                { value: 'over-6500', label: 'Over €6,500' }
            ]
        };

        // Sample survey questions
        const surveyQuestions = [
            {
                id: 1,
                brand: "Urban Style Co.",
                product: "Minimalist Sneakers",
                price: "$89",
                description: "Clean, versatile design for everyday wear",
                category: "footwear"
            },
            {
                id: 2,
                brand: "Eco Fashion",
                product: "Sustainable Tote Bag",
                price: "$156",
                description: "Made from recycled materials, perfect for daily use",
                category: "accessories"
            },
            {
                id: 3,
                brand: "Luxury Essentials",
                product: "Classic Gold Watch",
                price: "$299",
                description: "Timeless elegance meets modern functionality",
                category: "jewelry"
            },
            {
                id: 4,
                brand: "Street Vibes",
                product: "Oversized Hoodie",
                price: "$67",
                description: "Trending streetwear that everyone's talking about",
                category: "clothing"
            },
            {
                id: 5,
                brand: "Active Lifestyle",
                product: "Performance Running Shoes",
                price: "$134",
                description: "Advanced cushioning for your morning runs",
                category: "footwear"
            },
            {
                id: 6,
                brand: "Boho Chic",
                product: "Flowing Summer Dress",
                price: "$78",
                description: "Perfect for beach days and festival vibes",
                category: "clothing"
            },
            {
                id: 7,
                brand: "Tech Accessories",
                product: "Premium Phone Case",
                price: "$45",
                description: "Protection meets style in 6 colors",
                category: "tech"
            },
            {
                id: 8,
                brand: "Vintage Revival",
                product: "Retro Sunglasses",
                price: "$89",
                description: "90s comeback with modern UV protection",
                category: "accessories"
            },
            {
                id: 9,
                brand: "Minimalist Home",
                product: "Professional Backpack",
                price: "$123",
                description: "Clean lines for the modern professional",
                category: "accessories"
            },
            {
                id: 10,
                brand: "Fitness Forward",
                product: "Athletic Leggings Set",
                price: "$92",
                description: "From gym to street wear seamlessly",
                category: "activewear"
            },
            {
                id: 11,
                brand: "Artisan Crafts",
                product: "Handmade Silver Necklace",
                price: "$167",
                description: "Each piece tells a unique story",
                category: "jewelry"
            },
            {
                id: 12,
                brand: "Smart Casual",
                product: "Versatile Navy Blazer",
                price: "$198",
                description: "From office to dinner date effortlessly",
                category: "clothing"
            },
            {
                id: 13,
                brand: "Youth Culture",
                product: "Statement Earrings",
                price: "$34",
                description: "Bold self-expression in colorful design",
                category: "jewelry"
            },
            {
                id: 14,
                brand: "Outdoor Explorer",
                product: "Adventure Hiking Boots",
                price: "$178",
                description: "Built for any terrain and adventure",
                category: "footwear"
            },
            {
                id: 15,
                brand: "Evening Elegance",
                product: "Beaded Evening Clutch",
                price: "$145",
                description: "Sophistication for your next event",
                category: "accessories"
            }
        ];

        // Toggle continue button based on consent
        function toggleContinueButton() {
            const consentCheck = document.getElementById('consentCheck');
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.disabled = !consentCheck.checked;
        }

        // Show demographics form
        function showDemographics() {
            document.getElementById('disclaimerForm').style.display = 'none';
            document.getElementById('demographicForm').style.display = 'block';
        }

        // Update currency and income based on country selection
        function updateCurrencyAndIncome() {
            const countrySelect = document.getElementById('country');
            const currencyInput = document.getElementById('currency');
            const incomeSelect = document.getElementById('income');
            
            const selectedCountry = countrySelect.value;
            
            if (selectedCountry && currencyData[selectedCountry]) {
                const countryData = currencyData[selectedCountry];
                currencyInput.value = countryData.currency;
                
                // Update income options
                incomeSelect.innerHTML = '<option value="">Select income range</option>';
                
                const ranges = incomeRanges[countryData.currency] || incomeRanges['USD'];
                ranges.forEach(range => {
                    const option = document.createElement('option');
                    option.value = range.value;
                    option.textContent = range.label;
                    incomeSelect.appendChild(option);
                });
            }
            
            validateDemographics();
        }

        // Select gender option
        function selectGender(value) {
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            document.getElementById(value).checked = true;
            
            validateDemographics();
        }

        // Validate demographics form
        function validateDemographics() {
            const requiredFields = ['participantName', 'ageRange', 'country', 'income', 'primaryPlatform', 'shoppingFrequency'];
            const genderSelected = document.querySelector('input[name="gender"]:checked');
            
            const allFieldsFilled = requiredFields.every(field => {
                const element = document.getElementById(field);
                return element && element.value !== '';
            });
            
            const isValid = allFieldsFilled && genderSelected;
            document.getElementById('demographicsContinueBtn').disabled = !isValid;
        }

        // Show interface selection
        function showInterfaceSelection() {
            // Collect demographic data
            demographicData = {
                name: document.getElementById('participantName').value,
                age: document.getElementById('ageRange').value,
                country: document.getElementById('country').value,
                currency: document.getElementById('currency').value,
                income: document.getElementById('income').value,
                gender: document.querySelector('input[name="gender"]:checked').value,
                primaryPlatform: document.getElementById('primaryPlatform').value,
                shoppingFrequency: document.getElementById('shoppingFrequency').value,
                timestamp: new Date().toISOString()
            };
            
            console.log('Demographics collected:', demographicData);
            
            document.getElementById('demographicForm').style.display = 'none';
            document.getElementById('interfaceSelection').style.display = 'block';
        }

        // Select interface
        function selectInterface(interface) {
            document.querySelectorAll('.interface-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            selectedInterface = interface;
            document.getElementById('startExperienceBtn').disabled = false;
        }

        // Start survey experience
        function startSurveyExperience() {
            // Show instruction modal
            const platformNames = {
                'facebook': 'Facebook',
                'instagram': 'Instagram',
                'linkedin': 'LinkedIn',
                'tiktok': 'TikTok'
            };
            
            document.getElementById('platformName').textContent = platformNames[selectedInterface];
            document.getElementById('instructionModal').style.display = 'flex';
        }

        // Start feed experience
        function startFeedExperience() {
            document.getElementById('instructionModal').style.display = 'none';
            document.getElementById('interfaceSelection').style.display = 'none';
            document.getElementById('surveyHeader').style.display = 'block';
            document.getElementById('feedContainer').style.display = 'block';
            
            surveyStartTime = Date.now();
            scrollStartTime = Date.now();
            initializeSurvey();
        }

        // Initialize survey
        function initializeSurvey() {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = '';
            
            // Set survey title
            const titles = {
                'facebook': 'Facebook Feed',
                'instagram': 'Instagram Feed',
                'linkedin': 'LinkedIn Feed',
                'tiktok': 'TikTok For You'
            };
            document.getElementById('surveyTitle').textContent = titles[selectedInterface];
            
            // Generate all posts
            surveyQuestions.forEach((question, index) => {
                const post = createPost(question, index);
                feedContainer.appendChild(post);
            });
            
            updateProgress();
            
            // Start tracking scroll behavior
            startScrollTracking();
        }

        // Create post element
        function createPost(question, index) {
            const post = document.createElement('div');
            post.className = 'post';
            post.style.animationDelay = `${index * 0.1}s`;
            
            post.innerHTML = `
                <div class="post-header">
                    <div class="post-avatar">${question.brand.charAt(0)}</div>
                    <div class="post-info">
                        <h3>${question.brand}</h3>
                        <p>2 hours ago</p>
                    </div>
                </div>
                <div class="post-content">
                    <div class="post-text">Check out our new ${question.product}! ${question.description}</div>
                    <div class="post-image">
                        ${question.product}
                        <div class="price-tag">${question.price}</div>
                    </div>
                </div>
                <div class="post-actions">
                    <button class="action-btn like-btn" onclick="handleResponse(${question.id}, 'like')">❤️ Like</button>
                    <button class="action-btn share-btn" onclick="handleResponse(${question.id}, 'share')">📤 Share</button>
                    <button class="action-btn buy-btn" onclick="handleResponse(${question.id}, 'buy')">🛒 Buy</button>
                </div>
            `;
            
            return post;
        }

        // Handle user response
        function handleResponse(questionId, action) {
            hasEngaged = true;
            
            const timestamp = new Date().toISOString();
            const responseTime = Date.now() - startTime;
            const question = surveyQuestions.find(q => q.id === questionId);
            const viewTime = recordQuestionViewTime(questionId);
            
            const response = {
                questionId: questionId,
                interface: selectedInterface,
                action: action,
                timestamp: timestamp,
                responseTime: responseTime,
                viewTime: viewTime,
                brand: question.brand,
                product: question.product,
                price: question.price,
                category: question.category
            };
            
            responses.push(response);
            currentPost++;
            
            // Disable buttons and highlight selected
            const postElement = event.target.closest('.post');
            const buttons = postElement.querySelectorAll('.action-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.6';
            });
            
            event.target.classList.add('selected');
            updateProgress();
            
            // Auto-scroll to next post
            setTimeout(() => {
                scrollToNextPost();
            }, 800);
            
            // Check if survey complete
            if (currentPost >= surveyQuestions.length) {
                setTimeout(() => {
                    attemptSurveyCompletion();
                }, 1500);
            }
        }

        // Track question viewing time
        function recordQuestionViewTime(questionId) {
            const now = Date.now();
            if (!questionFirstView[questionId]) {
                questionFirstView[questionId] = now;
            }
            
            const viewTime = now - questionFirstView[questionId];
            questionViewTimes[questionId] = viewTime;
            return viewTime;
        }

        // Start scroll tracking
        function startScrollTracking() {
            const feedContainer = document.getElementById('feedContainer');
            
            feedContainer.addEventListener('scroll', function() {
                if (!isScrolling) {
                    isScrolling = true;
                    setTimeout(() => {
                        trackQuestionsInView();
                        isScrolling = false;
                    }, 100);
                }
            });
        }

        // Track which questions are in view
        function trackQuestionsInView() {
            const feedContainer = document.getElementById('feedContainer');
            const posts = feedContainer.querySelectorAll('.post');
            const containerRect = feedContainer.getBoundingClientRect();
            
            posts.forEach((post, index) => {
                const postRect = post.getBoundingClientRect();
                const questionId = surveyQuestions[index].id;
                
                const isVisible = postRect.top < containerRect.bottom && postRect.bottom > containerRect.top;
                
                if (isVisible && !questionFirstView[questionId]) {
                    questionFirstView[questionId] = Date.now();
                }
            });
        }

        // Scroll to next post
        function scrollToNextPost() {
            if (currentPost < surveyQuestions.length) {
                const posts = document.querySelectorAll('.post');
                const nextPost = posts[currentPost];
                if (nextPost) {
                    nextPost.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
            }
        }

        // Update progress
        function updateProgress() {
            const progress = (currentPost / surveyQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentPost').textContent = Math.min(currentPost + 1, surveyQuestions.length);
            document.getElementById('totalPosts').textContent = surveyQuestions.length;
        }

        // Attempt survey completion with validation
        function attemptSurveyCompletion() {
            const totalSurveyTime = Date.now() - surveyStartTime;
            const speedThreshold = 5000; // 5 seconds
            
            // Check if completed too quickly
            if (totalSurveyTime < speedThreshold && hasEngaged) {
                console.log('Survey completed too quickly, sending back to top');
                scrollToTop();
                return;
            }
            
            // Check if no engagement
            if (!hasEngaged) {
                showNoEngagementWarning();
                return;
            }
            
            // Normal completion
            completeSurvey();
        }

        // Show no engagement warning
        function showNoEngagementWarning() {
            document.getElementById('warningModal').style.display = 'flex';
        }

        // Go back to feed
        function goBackToFeed() {
            document.getElementById('warningModal').style.display = 'none';
            scrollToTop();
        }

        // Submit blank survey
        function submitBlankSurvey() {
            document.getElementById('warningModal').style.display = 'none';
            
            responses.push({
                type: 'blank_submission',
                interface: selectedInterface,
                timestamp: new Date().toISOString(),
                totalTime: Date.now() - surveyStartTime,
                reason: 'user_confirmed_blank'
            });
            
            completeSurvey();
        }

        // Scroll to top
        function scrollToTop() {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            
            hasEngaged = false;
            scrollStartTime = Date.now();
        }

        // Complete survey
        function completeSurvey() {
            document.getElementById('surveyHeader').style.display = 'none';
            document.getElementById('feedContainer').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'flex';
            
            console.log('Survey Complete!');
            console.log('Demographics:', demographicData);
            console.log('Interface:', selectedInterface);
            console.log('Responses:', responses);
        }

        // Download results
        function downloadResults() {
            const results = {
                demographicData: demographicData,
                surveyMetadata: {
                    interface: selectedInterface,
                    completedAt: new Date().toISOString(),
                    totalQuestions: surveyQuestions.length,
                    completedResponses: responses.filter(r => r.type !== 'blank_submission').length,
                    totalSurveyTime: surveyStartTime ? Date.now() - surveyStartTime : 0,
                    hasEngaged: hasEngaged
                },
                responses: responses,
                questionViewTimes: questionViewTimes
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `fashion_survey_${demographicData.age}_${demographicData.gender}_${selectedInterface}_${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Add event listeners for form validation
        document.addEventListener('DOMContentLoaded', function() {
            // Demographics form validation
            const demographicFields = ['participantName', 'ageRange', 'country', 'income', 'primaryPlatform', 'shoppingFrequency'];
            demographicFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', validateDemographics);
                    field.addEventListener('input', validateDemographics);
                }
            });
        });
    </script>
</body>
</html>
